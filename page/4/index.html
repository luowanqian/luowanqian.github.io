<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="袋熊的树洞">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="袋熊的树洞">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Luo Wanqian">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>袋熊的树洞</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">袋熊的树洞</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">日拱一卒，功不唐捐</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-diary">

    <a href="/diary" rel="section"><i class="fa fa-fw fa-calendar"></i>diary</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/09/Matplotlib%E5%A4%87%E5%BF%98%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/09/Matplotlib%E5%A4%87%E5%BF%98%E5%BD%95/" class="post-title-link" itemprop="url">Matplotlib备忘录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-09 20:00:12" itemprop="dateCreated datePublished" datetime="2018-05-09T20:00:12+08:00">2018-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>本文主要是记录一些 Matplotlib 的使用方法以及注意事项。</p>
<p><strong>Note:</strong> 如果没有特别说明，<code>plt</code> 代表 <code>matplotlib.pyplot</code>，<code>np</code> 代表 <code>numpy</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br></pre></td></tr></table></figure>

<p>本文代码主要在 Jupyter notebook 中执行，画图之前使用了一下 magic 方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br></pre></td></tr></table></figure>

<h2 id="创建多个子图"><a href="#创建多个子图" class="headerlink" title="创建多个子图"></a>创建多个子图</h2><p>一个常用的应用就是在一个 figure 里面画多个图，此时需要 <code>add_subplot</code> 方法或者 <code>subplots</code> 方法。</p>
<h3 id="使用-add-subplot"><a href="#使用-add-subplot" class="headerlink" title="使用 add_subplot"></a>使用 add_subplot</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure()</span><br><span class="line"></span><br><span class="line">ax1 = fig.add_subplot(1, 2, 1)</span><br><span class="line">ax2 = fig.add_subplot(1, 2, 2)</span><br><span class="line"></span><br><span class="line">ax1.plot(np.random.randn(50).cumsum(), &#x27;k--&#x27;)</span><br><span class="line">ax2.hist(np.random.randn(100), bins=20, color=&#x27;k&#x27;, alpha=0.3)</span><br></pre></td></tr></table></figure>

<img src="/2018/05/09/Matplotlib%E5%A4%87%E5%BF%98%E5%BD%95/1.png" class="">

<h3 id="使用-subplots"><a href="#使用-subplots" class="headerlink" title="使用 subplots"></a>使用 subplots</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fig, axes = plt.subplots(1, 2)</span><br><span class="line"></span><br><span class="line">ax1 = axes[0]</span><br><span class="line">ax2 = axes[1]</span><br><span class="line"></span><br><span class="line">ax1.plot(np.random.randn(50).cumsum(), &#x27;k--&#x27;)</span><br><span class="line">ax2.hist(np.random.randn(100), bins=20, color=&#x27;k&#x27;, alpha=0.3)</span><br></pre></td></tr></table></figure>

<h2 id="保存图像到文件中"><a href="#保存图像到文件中" class="headerlink" title="保存图像到文件中"></a>保存图像到文件中</h2><p>可以使用 <code>plt.savefig</code> 将图像保存到文件中，也可以使用 figure 对象的属性方法 <code>savefig</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data = np.arange(10)</span><br><span class="line">fig, ax = plt.subplots(1, 1)</span><br><span class="line">ax.plot(data)</span><br><span class="line"></span><br><span class="line">plt.savefig(&#x27;1.png&#x27;)</span><br><span class="line">fig.savefig(&#x27;2.png&#x27;)</span><br></pre></td></tr></table></figure>

<h2 id="特定图像"><a href="#特定图像" class="headerlink" title="特定图像"></a>特定图像</h2><h3 id="Histogram"><a href="#Histogram" class="headerlink" title="Histogram"></a>Histogram</h3><p>直方图 (Histogram) 使用的是 <code>hist</code> 函数进行绘制，<code>bins</code> 选项可以设置bin的个数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mu, sigma = 100, 15</span><br><span class="line">num_bins = 100</span><br><span class="line">x = mu + sigma * np.random.randn(1000000)</span><br><span class="line"></span><br><span class="line">n, bins, patches = plt.hist(x, num_bins, density=True)</span><br><span class="line"></span><br><span class="line">plt.title(&#x27;Histogram&#x27;)</span><br><span class="line">plt.grid(True)</span><br></pre></td></tr></table></figure>

<img src="/2018/05/09/Matplotlib%E5%A4%87%E5%BF%98%E5%BD%95/histogram.png" class="">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/06/Pandas%E5%A4%87%E5%BF%98%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/06/Pandas%E5%A4%87%E5%BF%98%E5%BD%95/" class="post-title-link" itemprop="url">Pandas备忘录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-06 22:29:26" itemprop="dateCreated datePublished" datetime="2018-05-06T22:29:26+08:00">2018-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Pandas备忘录系列文章"><a href="#1-Pandas备忘录系列文章" class="headerlink" title="1. Pandas备忘录系列文章"></a>1. Pandas备忘录系列文章</h2><ol>
<li><a href="/2018/09/03/Pandas%E5%A4%87%E5%BF%98%E5%BD%952/" title="Pandas备忘录2">Pandas备忘录2</a></li>
</ol>
<h2 id="2-介绍"><a href="#2-介绍" class="headerlink" title="2. 介绍"></a>2. 介绍</h2><p>本文主要是记录一些Pandas的使用方法以及注意事项</p>
<p><strong>Note:</strong> 如果没有特别说明，<code>pd</code> 指的是 <code>pandas</code>，<code>np</code> 指的是 <code>numpy</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>

<h2 id="3-构建DataFrame"><a href="#3-构建DataFrame" class="headerlink" title="3. 构建DataFrame"></a>3. 构建DataFrame</h2><p>构建一个DataFrame方法有很多，这里介绍一部分常用的方法，即</p>
<ul>
<li>From dict of ndarrays &#x2F; lists</li>
<li>From a list of dicts</li>
</ul>
<h3 id="3-1-From-dict-of-ndarrays-lists"><a href="#3-1-From-dict-of-ndarrays-lists" class="headerlink" title="3.1. From dict of ndarrays &#x2F; lists"></a>3.1. From dict of ndarrays &#x2F; lists</h3><p>输入数据为一个字典，字典的key为列名，字典的value为一个Numpy的数组或者一个list，存储DataFrame一列的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data = &#123;&#x27;one&#x27;: [1, 2, 3],</span><br><span class="line">...         &#x27;two&#x27;: [3, 2, 1]&#125;</span><br><span class="line">&gt;&gt;&gt; pd.DataFrame(data)</span><br><span class="line">   one  two</span><br><span class="line">0    1    3</span><br><span class="line">1    2    2</span><br><span class="line">2    3    1</span><br></pre></td></tr></table></figure>

<h3 id="3-2-From-a-list-of-dicts"><a href="#3-2-From-a-list-of-dicts" class="headerlink" title="3.2. From a list of dicts"></a>3.2. From a list of dicts</h3><p>输入数据为一个list，每个元素为一个字典，存储DataFrame一行的值，字典的key为列名，value为一个DataFrame中一个元素。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data = [&#123;&#x27;one&#x27;: 1, &#x27;two&#x27;: 3&#125;,</span><br><span class="line">...         &#123;&#x27;one&#x27;: 2, &#x27;two&#x27;: 2&#125;,</span><br><span class="line">...         &#123;&#x27;one&#x27;: 3, &#x27;two&#x27;: 1&#125;]</span><br><span class="line">&gt;&gt;&gt; pd.DataFrame(data)</span><br><span class="line">   one  two</span><br><span class="line">0    1    3</span><br><span class="line">1    2    2</span><br><span class="line">2    3    1</span><br></pre></td></tr></table></figure>

<h2 id="4-Series索引"><a href="#4-Series索引" class="headerlink" title="4. Series索引"></a>4. Series索引</h2><p>Series索引类似Numpy的数组索引，除了可以使用 integer 作为索引值，还可以使用 index 作为索引值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; obj = pd.Series(np.arange(4.), index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;])</span><br><span class="line">&gt;&gt;&gt; obj</span><br><span class="line">a    0.0</span><br><span class="line">b    1.0</span><br><span class="line">c    2.0</span><br><span class="line">d    3.0</span><br><span class="line">dtype: float64</span><br><span class="line">&gt;&gt;&gt; obj[&#x27;b&#x27;]</span><br><span class="line">1.0</span><br><span class="line">&gt;&gt;&gt; obj[1]</span><br><span class="line">1.0</span><br><span class="line">&gt;&gt;&gt; obj[:2]</span><br><span class="line">a    0.0</span><br><span class="line">b    1.0</span><br><span class="line">dtype: float64</span><br><span class="line">&gt;&gt;&gt; obj[obj &lt; 2]</span><br><span class="line">a    0.0</span><br><span class="line">b    1.0</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line"># 如果使用 label 索引，则索引区间为闭区间</span><br><span class="line">&gt;&gt;&gt; obj[&#x27;b&#x27;:&#x27;c&#x27;]</span><br><span class="line">b    1.0</span><br><span class="line">c    2.0</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<h2 id="5-DataFrame索引"><a href="#5-DataFrame索引" class="headerlink" title="5. DataFrame索引"></a>5. DataFrame索引</h2><p>先贴张DataFrame索引方法的表格，摘录自《Python for Data Analysis》。</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td>df[val]</td>
<td>Select single column or sequence of  columns from the DataFrame; special case conveniences: boolean array (filter rows), slice (slice rows), or boolean DataFrame (set values bases on some criterion)</td>
</tr>
<tr>
<td>df.loc[val]</td>
<td>Selects single row or subset of rows from the DataFrame by label</td>
</tr>
<tr>
<td>df.loc[:, val]</td>
<td>Selects single column or subset of columns by label</td>
</tr>
<tr>
<td>df.loc[val1, val2]</td>
<td>Select both rows and columns by label</td>
</tr>
<tr>
<td>df.iloc[where]</td>
<td>Selects single row of subsets of rows from the DataFrame by integer position</td>
</tr>
<tr>
<td>df.iloc[:, where]</td>
<td>Selects single column or subset of columns by integer position</td>
</tr>
<tr>
<td>df.iloc[where_i,  where_j]</td>
<td>Select both rows and columns by integer position</td>
</tr>
<tr>
<td>df.at[label_i, label_j]</td>
<td>Select a single scalar value by row and column label</td>
</tr>
<tr>
<td>df.iat[i, j]</td>
<td>Select a single scalar value by row and column position (integers)</td>
</tr>
</tbody></table>
<p>先创建一个数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data = pd.DataFrame(np.arange(16).reshape((4, 4)),</span><br><span class="line">...                     index=[&#x27;Ohio&#x27;, &#x27;Colorado&#x27;, &#x27;Utah&#x27;, &#x27;New York&#x27;],</span><br><span class="line">...                     columns=[&#x27;one&#x27;, &#x27;two&#x27;, &#x27;three&#x27;, &#x27;four&#x27;])</span><br><span class="line">&gt;&gt;&gt; data</span><br><span class="line">          one  two  three  four</span><br><span class="line">Ohio        0    1      2     3</span><br><span class="line">Colorado    4    5      6     7</span><br><span class="line">Utah        8    9     10    11</span><br><span class="line">New York   12   13     14    15</span><br></pre></td></tr></table></figure>

<h3 id="5-1-df-语法"><a href="#5-1-df-语法" class="headerlink" title="5.1. df[]语法"></a>5.1. df[]语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 利用单个label选择单列</span><br><span class="line">&gt;&gt;&gt; data[&#x27;two&#x27;]</span><br><span class="line">Ohio         1</span><br><span class="line">Colorado     5</span><br><span class="line">Utah         9</span><br><span class="line">New York    13</span><br><span class="line">Name: two, dtype: int64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 利用多个label选择多列，可以改变列顺序</span><br><span class="line">&gt;&gt;&gt; data[[&#x27;three&#x27;, &#x27;one&#x27;]]</span><br><span class="line">          three  one</span><br><span class="line">Ohio          2    0</span><br><span class="line">Colorado      6    4</span><br><span class="line">Utah         10    8</span><br><span class="line">New York     14   12</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 利用boolean数组选择多行</span><br><span class="line">&gt;&gt;&gt; bools = np.array([False, True, False, True])</span><br><span class="line">&gt;&gt;&gt; bools</span><br><span class="line">array([False,  True, False,  True])</span><br><span class="line">&gt;&gt;&gt; data[bools]</span><br><span class="line">          one  two  three  four</span><br><span class="line">Colorado    4    5      6     7</span><br><span class="line">New York   12   13     14    15</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 利用切片(slice)选择多行，类似Numpy的语法</span><br><span class="line">&gt;&gt;&gt; data[:2]</span><br><span class="line">          one  two  three  four</span><br><span class="line">Ohio        0    1      2     3</span><br><span class="line">Colorado    4    5      6     7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 利用boolean DataFrame选择数据</span><br><span class="line">&gt;&gt;&gt; data &lt; 5</span><br><span class="line">            one    two  three   four</span><br><span class="line">Ohio       True   True   True   True</span><br><span class="line">Colorado   True  False  False  False</span><br><span class="line">Utah      False  False  False  False</span><br><span class="line">New York  False  False  False  False</span><br><span class="line">&gt;&gt;&gt; data[data &lt; 5] = 0</span><br><span class="line">&gt;&gt;&gt; data</span><br><span class="line">          one  two  three  four</span><br><span class="line">Ohio        0    0      0     0</span><br><span class="line">Colorado    0    5      6     7</span><br><span class="line">Utah        8    9     10    11</span><br><span class="line">New York   12   13     14    15</span><br></pre></td></tr></table></figure>

<h3 id="5-2-df-loc语法"><a href="#5-2-df-loc语法" class="headerlink" title="5.2. df.loc语法"></a>5.2. df.loc语法</h3><p><code>df.loc[]</code> 索引值为 axis labels</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># 使用 df.loc[val] 选择行</span><br><span class="line">&gt;&gt;&gt; data.loc[&#x27;Utah&#x27;]</span><br><span class="line">one       8</span><br><span class="line">two       9</span><br><span class="line">three    10</span><br><span class="line">four     11</span><br><span class="line">Name: Utah, dtype: int64</span><br><span class="line">&gt;&gt;&gt; data.loc[[&#x27;Utah&#x27;, &#x27;Ohio&#x27;]]</span><br><span class="line">      one  two  three  four</span><br><span class="line">Utah    8    9     10    11</span><br><span class="line">Ohio    0    1      2     3</span><br><span class="line"># 如果使用 label 索引，则索引区间为闭区间</span><br><span class="line">&gt;&gt;&gt; data.loc[:&#x27;Utah&#x27;]</span><br><span class="line">          one  two  three  four</span><br><span class="line">Ohio        0    1      2     3</span><br><span class="line">Colorado    4    5      6     7</span><br><span class="line">Utah        8    9     10    11</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 使用 df.loc[:, val] 选择列</span><br><span class="line">&gt;&gt;&gt; data.loc[:, &#x27;one&#x27;]</span><br><span class="line">Ohio         0</span><br><span class="line">Colorado     4</span><br><span class="line">Utah         8</span><br><span class="line">New York    12</span><br><span class="line">Name: one, dtype: int64</span><br><span class="line">&gt;&gt;&gt; data.loc[:, [&#x27;one&#x27;, &#x27;two&#x27;]]</span><br><span class="line">          one  two</span><br><span class="line">Ohio        0    1</span><br><span class="line">Colorado    4    5</span><br><span class="line">Utah        8    9</span><br><span class="line">New York   12   13</span><br><span class="line"># 如果使用 label 索引，则索引区间为闭区间</span><br><span class="line">&gt;&gt;&gt; data.loc[:, :&#x27;two&#x27;]</span><br><span class="line">          one  two</span><br><span class="line">Ohio        0    1</span><br><span class="line">Colorado    4    5</span><br><span class="line">Utah        8    9</span><br><span class="line">New York   12   13</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 使用 df.loc[val1, val2] 选择多行多列</span><br><span class="line">&gt;&gt;&gt; data.loc[[&#x27;Colorado&#x27;, &#x27;Ohio&#x27;], [&#x27;two&#x27;, &#x27;three&#x27;]]</span><br><span class="line">          two  three</span><br><span class="line">Colorado    5      6</span><br><span class="line">Ohio        1      2</span><br></pre></td></tr></table></figure>

<h3 id="5-3-df-iloc语法"><a href="#5-3-df-iloc语法" class="headerlink" title="5.3. df.iloc语法"></a>5.3. df.iloc语法</h3><p><code>df.iloc[]</code> 索引值为 integers</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># 使用 df.iloc[where] 选择行</span><br><span class="line">&gt;&gt;&gt; data.iloc[2]</span><br><span class="line">one       8</span><br><span class="line">two       9</span><br><span class="line">three    10</span><br><span class="line">four     11</span><br><span class="line">Name: Utah, dtype: int64</span><br><span class="line">&gt;&gt;&gt; data.iloc[[2,1]]</span><br><span class="line">          one  two  three  four</span><br><span class="line">Utah        8    9     10    11</span><br><span class="line">Colorado    4    5      6     7</span><br><span class="line">&gt;&gt;&gt; data.iloc[:2]</span><br><span class="line">          one  two  three  four</span><br><span class="line">Ohio        0    1      2     3</span><br><span class="line">Colorado    4    5      6     7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 使用 df.iloc[:, where] 选择列</span><br><span class="line">&gt;&gt;&gt; data.iloc[:, 1]</span><br><span class="line">Ohio         1</span><br><span class="line">Colorado     5</span><br><span class="line">Utah         9</span><br><span class="line">New York    13</span><br><span class="line">Name: two, dtype: int64</span><br><span class="line">&gt;&gt;&gt; data.iloc[:, [2, 0]]</span><br><span class="line">          three  one</span><br><span class="line">Ohio          2    0</span><br><span class="line">Colorado      6    4</span><br><span class="line">Utah         10    8</span><br><span class="line">New York     14   12</span><br><span class="line">&gt;&gt;&gt; data.iloc[:, :2]</span><br><span class="line">          one  two</span><br><span class="line">Ohio        0    1</span><br><span class="line">Colorado    4    5</span><br><span class="line">Utah        8    9</span><br><span class="line">New York   12   13</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 使用 df.iloc[where_i, where_j] 选择多行多列</span><br><span class="line">&gt;&gt;&gt; data.iloc[2, :2]</span><br><span class="line">one    8</span><br><span class="line">two    9</span><br><span class="line">Name: Utah, dtype: int64</span><br><span class="line">&gt;&gt;&gt; data.iloc[:2, :2]</span><br><span class="line">          one  two</span><br><span class="line">Ohio        0    1</span><br><span class="line">Colorado    4    5</span><br></pre></td></tr></table></figure>

<h3 id="5-4-Reset-Index"><a href="#5-4-Reset-Index" class="headerlink" title="5.4. Reset Index"></a>5.4. Reset Index</h3><p>可以使用DataFrame的<code>reset_index()</code>函数将index变为DataFrame的一列，原index替换为递增的整数索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data.reset_index()</span><br><span class="line">      index  one  two  three  four</span><br><span class="line">0      Ohio    0    1      2     3</span><br><span class="line">1  Colorado    4    5      6     7</span><br><span class="line">2      Utah    8    9     10    11</span><br><span class="line">3  New York   12   13     14    15</span><br></pre></td></tr></table></figure>

<p>这个函数还有一个用处就是可以给每一行编一个号，如果index已为递增的整数索引，再调用<code>reset_index()</code>函数时，就会多出一列，内容为递增整数，相当于给每一行编个号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data2 = data.reset_index()</span><br><span class="line">&gt;&gt;&gt; data2</span><br><span class="line">      index  one  two  three  four</span><br><span class="line">0      Ohio    0    1      2     3</span><br><span class="line">1  Colorado    4    5      6     7</span><br><span class="line">2      Utah    8    9     10    11</span><br><span class="line">3  New York   12   13     14    15</span><br><span class="line">&gt;&gt;&gt; data2.reset_index()</span><br><span class="line">   level_0     index  one  two  three  four</span><br><span class="line">0        0      Ohio    0    1      2     3</span><br><span class="line">1        1  Colorado    4    5      6     7</span><br><span class="line">2        2      Utah    8    9     10    11</span><br><span class="line">3        3  New York   12   13     14    15</span><br></pre></td></tr></table></figure>

<p>列<code>level_0</code>可以用于数据编号。</p>
<h2 id="6-Series数据映射"><a href="#6-Series数据映射" class="headerlink" title="6. Series数据映射"></a>6. Series数据映射</h2><p>已知数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data = pd.DataFrame(&#123;&#x27;Age&#x27;: [22, 38, 26, 35, 35],</span><br><span class="line">...                      &#x27;Sex&#x27;: [&#x27;male&#x27;, &#x27;female&#x27;, &#x27;female&#x27;, &#x27;female&#x27;, &#x27;male&#x27;]&#125;)</span><br><span class="line">&gt;&gt;&gt; data</span><br><span class="line">   Age     Sex</span><br><span class="line">0   22    male</span><br><span class="line">1   38  female</span><br><span class="line">2   26  female</span><br><span class="line">3   35  female</span><br><span class="line">4   35    male</span><br></pre></td></tr></table></figure>

<p><code>Sex</code> 那一列的数据取值有两种，分别为 <code>female</code> 和 <code>male</code>，此时想要作一个数据映射</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">female -&gt; 0</span><br><span class="line">male -&gt; 1</span><br></pre></td></tr></table></figure>

<p>可以使用 <code>map()</code> 函数，输入映射参数 (映射用一个字典表示)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; sex_to_num = &#123;&#x27;female&#x27;: 0, &#x27;male&#x27;: 1&#125;</span><br><span class="line">&gt;&gt;&gt; data[&#x27;Sex&#x27;] = data[&#x27;Sex&#x27;].map(sex_to_num)</span><br><span class="line">&gt;&gt;&gt; data</span><br><span class="line">   Age  Sex</span><br><span class="line">0   22    1</span><br><span class="line">1   38    0</span><br><span class="line">2   26    0</span><br><span class="line">3   35    0</span><br><span class="line">4   35    1</span><br></pre></td></tr></table></figure>

<h2 id="7-缺失值"><a href="#7-缺失值" class="headerlink" title="7. 缺失值"></a>7. 缺失值</h2><p><strong>Note:</strong> 本节所述的 <code>NA</code> 代表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from numpy import nan as NA</span><br></pre></td></tr></table></figure>

<h3 id="7-1-缺失值分析"><a href="#7-1-缺失值分析" class="headerlink" title="7.1. 缺失值分析"></a>7.1. 缺失值分析</h3><p>首先分析数据缺失值情况</p>
<ol>
<li>Series</li>
</ol>
<p>对于 Series，可以使用 <code>isnull()</code> 函数判断 Series 中的数据是否为缺失值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data = pd.Series([1, NA, 3.5, NA, 7])</span><br><span class="line">&gt;&gt;&gt; data</span><br><span class="line">0    1.0</span><br><span class="line">1    NaN</span><br><span class="line">2    3.5</span><br><span class="line">3    NaN</span><br><span class="line">4    7.0</span><br><span class="line">dtype: float64</span><br><span class="line">&gt;&gt;&gt; data.isnull()</span><br><span class="line">0    False</span><br><span class="line">1     True</span><br><span class="line">2    False</span><br><span class="line">3     True</span><br><span class="line">4    False</span><br><span class="line">dtype: bool</span><br></pre></td></tr></table></figure>

<p>要判断有多少个缺失值，可以使用 <code>sum()</code> 判断 <code>isnull()</code> 返回的 Boolean 数组中有多少个 True。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data.isnull().sum()</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>DataFrame</li>
</ol>
<p>对于 DataFrame，同样可以使用 <code>isnull()</code> 函数判断数据是否为缺失值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data = pd.DataFrame([[1., 6.5, 3.], [1, NA, NA],</span><br><span class="line">...                      [NA, NA, NA], [NA, 6.5, 3.]])</span><br><span class="line">&gt;&gt;&gt; data</span><br><span class="line">     0    1    2</span><br><span class="line">0  1.0  6.5  3.0</span><br><span class="line">1  1.0  NaN  NaN</span><br><span class="line">2  NaN  NaN  NaN</span><br><span class="line">3  NaN  6.5  3.0</span><br><span class="line">&gt;&gt;&gt; data.isnull()</span><br><span class="line">       0      1      2</span><br><span class="line">0  False  False  False</span><br><span class="line">1  False   True   True</span><br><span class="line">2   True   True   True</span><br><span class="line">3   True  False  False</span><br></pre></td></tr></table></figure>

<p>如果要知道每一列的缺失值是多少，可以使用 <code>info()</code> 函数，或者将 <code>isnull()</code> 与 <code>sum()</code> 配合起来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data.info()</span><br><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 4 entries, 0 to 3</span><br><span class="line">Data columns (total 3 columns):</span><br><span class="line">0    2 non-null float64</span><br><span class="line">1    2 non-null float64</span><br><span class="line">2    2 non-null float64</span><br><span class="line">dtypes: float64(3)</span><br><span class="line">memory usage: 176.0 bytes</span><br><span class="line">&gt;&gt;&gt; data.isnull().sum()</span><br><span class="line">0    2</span><br><span class="line">1    2</span><br><span class="line">2    2</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>

<p>如果要知道缺失值总数，可以作两次 <code>sum()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data.isnull().sum().sum()</span><br><span class="line">6</span><br></pre></td></tr></table></figure>

<h3 id="7-2-缺失值补全"><a href="#7-2-缺失值补全" class="headerlink" title="7.2. 缺失值补全"></a>7.2. 缺失值补全</h3><p>处理缺失值的一个方法就是使用插值或者自设的值补全缺失值。首先构造一个有缺失值的 DataFrame</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df = pd.DataFrame(np.random.randn(7, 3))</span><br><span class="line">&gt;&gt;&gt; df.iloc[:4, 1] = NA</span><br><span class="line">&gt;&gt;&gt; df.iloc[:2, 2] = NA</span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">          0         1         2</span><br><span class="line">0  1.309480       NaN       NaN</span><br><span class="line">1 -0.542253       NaN       NaN</span><br><span class="line">2 -1.129503       NaN -0.396921</span><br><span class="line">3  1.172466       NaN -1.114420</span><br><span class="line">4  0.893893  0.572520  0.648532</span><br><span class="line">5  0.293066  1.875362 -0.426759</span><br><span class="line">6 -0.389516  0.379184  0.759198</span><br></pre></td></tr></table></figure>

<ol>
<li>使用自设的值补全缺失值</li>
</ol>
<p>这里主要使用函数 <code>fillna()</code>，传入一个值，则缺失值就被设为该值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 缺失值使用0补全</span><br><span class="line">&gt;&gt;&gt; df.fillna(0)</span><br><span class="line">          0         1         2</span><br><span class="line">0  1.309480  0.000000  0.000000</span><br><span class="line">1 -0.542253  0.000000  0.000000</span><br><span class="line">2 -1.129503  0.000000 -0.396921</span><br><span class="line">3  1.172466  0.000000 -1.114420</span><br><span class="line">4  0.893893  0.572520  0.648532</span><br><span class="line">5  0.293066  1.875362 -0.426759</span><br><span class="line">6 -0.389516  0.379184  0.759198</span><br></pre></td></tr></table></figure>

<p>如果传入的是一个字典，则可以对每一列的缺失值设定不同的补全值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 第二列缺失值用0.5补全，第三列缺失值用0补全</span><br><span class="line">&gt;&gt;&gt; df.fillna(&#123;1: 0.5, 2: 0&#125;)</span><br><span class="line">          0         1         2</span><br><span class="line">0  1.309480  0.500000  0.000000</span><br><span class="line">1 -0.542253  0.500000  0.000000</span><br><span class="line">2 -1.129503  0.500000 -0.396921</span><br><span class="line">3  1.172466  0.500000 -1.114420</span><br><span class="line">4  0.893893  0.572520  0.648532</span><br><span class="line">5  0.293066  1.875362 -0.426759</span><br><span class="line">6 -0.389516  0.379184  0.759198</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>插值补全缺失值</li>
</ol>
<p>这里主要使用函数 <code>fillna()</code> 的 <code>method</code> 参数，例子中数据由于某列第一个元素有缺失，所以方法选择 backfill。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df.fillna(method=&#x27;backfill&#x27;)</span><br><span class="line">          0         1         2</span><br><span class="line">0  1.309480  0.572520 -0.396921</span><br><span class="line">1 -0.542253  0.572520 -0.396921</span><br><span class="line">2 -1.129503  0.572520 -0.396921</span><br><span class="line">3  1.172466  0.572520 -1.114420</span><br><span class="line">4  0.893893  0.572520  0.648532</span><br><span class="line">5  0.293066  1.875362 -0.426759</span><br><span class="line">6 -0.389516  0.379184  0.759198</span><br></pre></td></tr></table></figure>

<h3 id="7-3-缺失值删除"><a href="#7-3-缺失值删除" class="headerlink" title="7.3. 缺失值删除"></a>7.3. 缺失值删除</h3><ol>
<li>删除有缺失值的行</li>
</ol>
<p>DataFrame的<code>dropna</code>函数默认是删除有缺失值的行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df = pd.DataFrame(&#123;&quot;name&quot;: [&#x27;Alfred&#x27;, &#x27;Batman&#x27;, &#x27;Catwoman&#x27;],</span><br><span class="line">...                    &quot;toy&quot;: [np.nan, &#x27;Batmobile&#x27;, &#x27;Bullwhip&#x27;],</span><br><span class="line">...                    &quot;born&quot;: [pd.NaT, pd.Timestamp(&quot;1940-04-25&quot;), pd.NaT]&#125;)</span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">       name        toy       born</span><br><span class="line">0    Alfred        NaN        NaT</span><br><span class="line">1    Batman  Batmobile 1940-04-25</span><br><span class="line">2  Catwoman   Bullwhip        NaT</span><br><span class="line">&gt;&gt;&gt; df.dropna()</span><br><span class="line">     name        toy       born</span><br><span class="line">1  Batman  Batmobile 1940-04-25</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>删除有缺失值的列</li>
</ol>
<p>设定<code>dropna</code>函数的参数axis为1可以删除有缺失值的列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df = pd.DataFrame(&#123;&quot;name&quot;: [&#x27;Alfred&#x27;, &#x27;Batman&#x27;, &#x27;Catwoman&#x27;],</span><br><span class="line">...                    &quot;toy&quot;: [np.nan, &#x27;Batmobile&#x27;, &#x27;Bullwhip&#x27;],</span><br><span class="line">...                    &quot;born&quot;: [pd.NaT, pd.Timestamp(&quot;1940-04-25&quot;), pd.NaT]&#125;)</span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">       name        toy       born</span><br><span class="line">0    Alfred        NaN        NaT</span><br><span class="line">1    Batman  Batmobile 1940-04-25</span><br><span class="line">2  Catwoman   Bullwhip        NaT</span><br><span class="line">&gt;&gt;&gt; df.dropna(axis=1)</span><br><span class="line">       name</span><br><span class="line">0    Alfred</span><br><span class="line">1    Batman</span><br><span class="line">2  Catwoman</span><br></pre></td></tr></table></figure>

<h2 id="8-重复值"><a href="#8-重复值" class="headerlink" title="8. 重复值"></a>8. 重复值</h2><p>已知DataFrame</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data = pd.DataFrame(&#123;&#x27;k1&#x27;: [&#x27;one&#x27;, &#x27;two&#x27;] * 3 + [&#x27;two&#x27;],</span><br><span class="line">...                      &#x27;k2&#x27;: [1, 1, 2, 3, 3, 4, 4]&#125;)</span><br><span class="line">&gt;&gt;&gt; data</span><br><span class="line">    k1  k2</span><br><span class="line">0  one   1</span><br><span class="line">1  two   1</span><br><span class="line">2  one   2</span><br><span class="line">3  two   3</span><br><span class="line">4  one   3</span><br><span class="line">5  two   4</span><br><span class="line">6  two   4</span><br></pre></td></tr></table></figure>

<h3 id="8-1-删除重复值"><a href="#8-1-删除重复值" class="headerlink" title="8.1. 删除重复值"></a>8.1. 删除重复值</h3><p>可以使用函数<code>drop_duplicates()</code>删除重复值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data.drop_duplicates()</span><br><span class="line">    k1  k2</span><br><span class="line">0  one   1</span><br><span class="line">1  two   1</span><br><span class="line">2  one   2</span><br><span class="line">3  two   3</span><br><span class="line">4  one   3</span><br><span class="line">5  two   4</span><br></pre></td></tr></table></figure>

<p>函数<code>drop_duplicates()</code>默认考虑的是全部列，也可以设定某些列来判断是否重复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data.drop_duplicates([&#x27;k1&#x27;])</span><br><span class="line">    k1  k2</span><br><span class="line">0  one   1</span><br><span class="line">1  two   1</span><br></pre></td></tr></table></figure>

<h2 id="9-排序"><a href="#9-排序" class="headerlink" title="9. 排序"></a>9. 排序</h2><p>已知DataFrame</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df = pd.DataFrame(&#123;&#x27;b&#x27;: [4, 7, -3, 2], &#x27;a&#x27;: [0, 1, 0, 1]&#125;)</span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">   a  b</span><br><span class="line">0  0  4</span><br><span class="line">1  1  7</span><br><span class="line">2  0 -3</span><br><span class="line">3  1  2</span><br></pre></td></tr></table></figure>

<h3 id="9-1-根据某些列进行排序"><a href="#9-1-根据某些列进行排序" class="headerlink" title="9.1. 根据某些列进行排序"></a>9.1. 根据某些列进行排序</h3><p>排序使用函数<code>sort_values()</code>，如果要根据某些列进行排序，可以设定<code>by=</code>参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df.sort_values(by=&#x27;a&#x27;)</span><br><span class="line">   a  b</span><br><span class="line">0  0  4</span><br><span class="line">2  0 -3</span><br><span class="line">1  1  7</span><br><span class="line">3  1  2</span><br><span class="line">&gt;&gt;&gt; df.sort_values(by=[&#x27;a&#x27;, &#x27;b&#x27;])</span><br><span class="line">   a  b</span><br><span class="line">2  0 -3</span><br><span class="line">0  0  4</span><br><span class="line">3  1  2</span><br><span class="line">1  1  7</span><br></pre></td></tr></table></figure>

<h2 id="10-GroupBy"><a href="#10-GroupBy" class="headerlink" title="10. GroupBy"></a>10. GroupBy</h2><p>已知DataFrame</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df = pd.DataFrame(&#123;&#x27;key1&#x27;:[&#x27;a&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;b&#x27;,&#x27;a&#x27;],</span><br><span class="line">...                    &#x27;key2&#x27;:[&#x27;one&#x27;,&#x27;two&#x27;,&#x27;one&#x27;,&#x27;two&#x27;,&#x27;one&#x27;],</span><br><span class="line">...                    &#x27;data1&#x27;:np.random.randn(5),</span><br><span class="line">...                    &#x27;data2&#x27;:np.random.randn(5)&#125;)</span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">      data1     data2 key1 key2</span><br><span class="line">0  2.462027  0.054159    a  one</span><br><span class="line">1  0.283423 -0.658160    a  two</span><br><span class="line">2 -0.969307 -0.407126    b  one</span><br><span class="line">3 -0.636756  1.925338    b  two</span><br><span class="line">4 -0.408266  1.833710    a  one</span><br></pre></td></tr></table></figure>

<h3 id="10-1-查看分组名"><a href="#10-1-查看分组名" class="headerlink" title="10.1. 查看分组名"></a>10.1. 查看分组名</h3><p>DataFrame分了组后，想知道每个分组的名字，可以写为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df.groupby(&#x27;key1&#x27;).groups</span><br><span class="line">&#123;&#x27;a&#x27;: Int64Index([0, 1, 4], dtype=&#x27;int64&#x27;), &#x27;b&#x27;: Int64Index([2, 3], dtype=&#x27;int64&#x27;)&#125;</span><br><span class="line">&gt;&gt;&gt; df.groupby(&#x27;key1&#x27;).groups.keys()</span><br><span class="line">dict_keys([&#x27;a&#x27;, &#x27;b&#x27;])</span><br></pre></td></tr></table></figure>

<h3 id="10-2-分组计算和以及平均值"><a href="#10-2-分组计算和以及平均值" class="headerlink" title="10.2. 分组计算和以及平均值"></a>10.2. 分组计算和以及平均值</h3><p>如果想要根据列<code>key1</code>的值分组计算<code>data1</code>的和，可以写为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df[&#x27;data1&#x27;].groupby(df[&#x27;key1&#x27;]).sum().reset_index()</span><br><span class="line">  key1     data1</span><br><span class="line">0    a  2.337185</span><br><span class="line">1    b -1.606063</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df.filter([&#x27;data1&#x27;, &#x27;key1&#x27;]).groupby(&#x27;key1&#x27;, as_index=False).sum()</span><br><span class="line">  key1     data1</span><br><span class="line">0    a  2.337185</span><br><span class="line">1    b -1.606063</span><br></pre></td></tr></table></figure>

<p>这个<code>as_index=False</code>使得<code>key1</code>的值不作为index。计算平均值只需要将<code>sum()</code>换成<code>mean()</code>即可。</p>
<h2 id="11-Merge"><a href="#11-Merge" class="headerlink" title="11. Merge"></a>11. Merge</h2><h3 id="11-1-笛卡尔乘积"><a href="#11-1-笛卡尔乘积" class="headerlink" title="11.1. 笛卡尔乘积"></a>11.1. 笛卡尔乘积</h3><p>两个集合$X$和$Y$的笛卡尔乘积(Cartesian product)，表示为$X \times Y$，是指第一个对象是$X$的成员而第二个对象是$Y$的所有可能有序对的其中一个成员。举个例子，假设集合$A &#x3D; { a,b  }$，集合$B &#x3D; { 0, 1, 2 }$，则两个集合的笛卡尔积为 ${ (a, 0), (a, 1), (a, 2), (b, 0),  (b, 1), (b, 2) }$。使用Pandas的<code>merge</code>函数可以实现两个DataFrame的笛卡尔积。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df1 = pd.DataFrame(&#123;&#x27;A&#x27;: [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]&#125;)</span><br><span class="line">&gt;&gt;&gt; df1</span><br><span class="line">   A</span><br><span class="line">0  a</span><br><span class="line">1  b</span><br><span class="line">2  c</span><br><span class="line">&gt;&gt;&gt; df2 = pd.DataFrame(&#123;&#x27;B&#x27;: [0, 1, 2]&#125;)</span><br><span class="line">&gt;&gt;&gt; df2</span><br><span class="line">   B</span><br><span class="line">0  0</span><br><span class="line">1  1</span><br><span class="line">2  2</span><br><span class="line">&gt;&gt;&gt; pd.merge(df1.assign(foo=0), df2.assign(foo=0), on=[&#x27;foo&#x27;]).drop(columns=[&#x27;foo&#x27;])</span><br><span class="line">   A  B</span><br><span class="line">0  a  0</span><br><span class="line">1  a  1</span><br><span class="line">2  a  2</span><br><span class="line">3  b  0</span><br><span class="line">4  b  1</span><br><span class="line">5  b  2</span><br><span class="line">6  c  0</span><br><span class="line">7  c  1</span><br><span class="line">8  c  2</span><br></pre></td></tr></table></figure>

<p>主要是实现思想是增加一列<code>foo</code>，值设为0，然后使用<code>merge</code>函数进行合并。</p>
<h2 id="12-读取数据"><a href="#12-读取数据" class="headerlink" title="12. 读取数据"></a>12. 读取数据</h2><h3 id="12-1-读取csv文件"><a href="#12-1-读取csv文件" class="headerlink" title="12.1. 读取csv文件"></a>12.1. 读取csv文件</h3><p>读取csv数据文件需要用到 <code>read_csv()</code> 函数</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/03/Numpy%E5%A4%87%E5%BF%98%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/03/Numpy%E5%A4%87%E5%BF%98%E5%BD%95/" class="post-title-link" itemprop="url">Numpy备忘录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-03 23:10:53" itemprop="dateCreated datePublished" datetime="2018-05-03T23:10:53+08:00">2018-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>本文主要是记录一些Numpy的使用方法以及注意事项。</p>
<p><strong>Note:</strong> 如果没有特别说明，<code>np</code> 指的是 <code>numpy</code>，代表导入的 numpy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br></pre></td></tr></table></figure>

<p>PS: 网上找到一份Numpy的CheatSheet，内容不错，感兴趣的可以去下载：<a target="_blank" rel="noopener" href="https://www.dataquest.io/blog/numpy-cheat-sheet/">Numpy CheatSheet</a></p>
<h2 id="转换ndarray数据类型"><a href="#转换ndarray数据类型" class="headerlink" title="转换ndarray数据类型"></a>转换ndarray数据类型</h2><p>如果想转换ndarray的数据类型，可以使用ndarray的 <code>astype</code> 方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>arr.dtype</span><br><span class="line">dtype(<span class="string">&#x27;int64&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>float_arr = arr.astype(np.float64)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>float_arr.dtype</span><br><span class="line">dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Note:</strong> 调用 <code>astype</code> 方法会生成新的数组，因此需要赋值到一个变量上。</p>
<h2 id="切片不会生成新的数组"><a href="#切片不会生成新的数组" class="headerlink" title="切片不会生成新的数组"></a>切片不会生成新的数组</h2><p>对数组进行切片后，返回的数组并不是原始数组的拷贝，只是一个对原始数组的引用，如果对切片后的数组进行数据修改，原始数组相应的位置数据会被修改。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; arr = np.arange(10)</span><br><span class="line">&gt;&gt;&gt; arr</span><br><span class="line">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span><br><span class="line">&gt;&gt;&gt; new_arr = arr[5:8]</span><br><span class="line">&gt;&gt;&gt; new_arr</span><br><span class="line">array([5, 6, 7])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; new_arr[:] = 12</span><br><span class="line">&gt;&gt;&gt; new_arr</span><br><span class="line">array([12, 12, 12])</span><br><span class="line">&gt;&gt;&gt; arr</span><br><span class="line">array([ 0,  1,  2,  3,  4, 12, 12, 12,  8,  9])</span><br></pre></td></tr></table></figure>

<p>如果想要切片后的数组是原始数组的拷贝，需要调用 <code>copy()</code> 方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; new_arr = arr[5:8].copy()</span><br></pre></td></tr></table></figure>

<h2 id="Axis编号"><a href="#Axis编号" class="headerlink" title="Axis编号"></a>Axis编号</h2><p>调用一些Numpy函数时会遇到设置 <code>axis</code> 参数，该参数可以设为 <code>0</code> 或 <code>1</code> ，对于这两个值表示的意义，可以参考下图</p>
<img src="/2018/05/03/Numpy%E5%A4%87%E5%BF%98%E5%BD%95/1.png" class="">

<p>也就是说<code>axis 0</code> 代表行方向，<code>axis 1</code> 代表列方向。例如，我们使用 <code>mean()</code> 计算矩阵的平均值时，<code>A.mean(axis=0)</code> 代表每个平均值是沿着行方向计算可得，<code>A.mean(axis=1)</code> 代表每个平均值是沿着列方向计算可得。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; A = np.random.randn(2, 3)</span><br><span class="line">&gt;&gt;&gt; A</span><br><span class="line">array([[-0.40797393,  0.24059956, -1.57582642],</span><br><span class="line">       [ 0.31626161, -0.07033558,  0.58346107]])</span><br><span class="line">&gt;&gt;&gt; A.mean(axis=0)</span><br><span class="line">array([-0.04585616,  0.08513199, -0.49618267])</span><br><span class="line">&gt;&gt;&gt; A.mean(axis=1)</span><br><span class="line">array([-0.58106693,  0.27646237])</span><br></pre></td></tr></table></figure>

<p><code>A.mean(axis=0)</code> 大小为矩阵A列的个数，<code>A.mean(axis=1)</code>大小为矩阵A行的个数。</p>
<h2 id="统计Boolean数组中True的个数"><a href="#统计Boolean数组中True的个数" class="headerlink" title="统计Boolean数组中True的个数"></a>统计Boolean数组中True的个数</h2><p>Boolean值通常可以转换成 0 (False) 或 1 (True)，因此可以使用 <code>sum()</code> 函数统计Boolean数组中 True 的个数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; bools = np.array([False, True, True, False, False])</span><br><span class="line">&gt;&gt;&gt; bools.sum()</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt; np.sum(bools)</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p>既然可以知道数组中 True 的个数，自然也可以知道 True 所占的比例，此时可以用 <code>mean()</code> 函数进行计算</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; bools.mean()</span><br><span class="line">0.4</span><br><span class="line">&gt;&gt;&gt; np.mean(bools)</span><br><span class="line">0.4</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/03/%E7%BB%88%E7%AB%AF%E5%BF%AB%E6%8D%B7%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/03/%E7%BB%88%E7%AB%AF%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="post-title-link" itemprop="url">终端快捷键</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-03 20:34:20" itemprop="dateCreated datePublished" datetime="2018-05-03T20:34:20+08:00">2018-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>OS: OS X 10.11.6</p>
<p>Shell: bash and zsh</p>
<p>Other: iTerm2</p>
<h2 id="快捷键列表"><a href="#快捷键列表" class="headerlink" title="快捷键列表"></a>快捷键列表</h2><table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>Option + Left or Right</td>
<td>光标按单词前移或后移</td>
</tr>
<tr>
<td>Control + F or B</td>
<td>光标向前或向后移动一个字符</td>
</tr>
<tr>
<td>Control + D</td>
<td>删除当前光标的字符</td>
</tr>
<tr>
<td>Control + H</td>
<td>删除光标之前的字符</td>
</tr>
<tr>
<td>Control + W</td>
<td>删除光标之前的单词</td>
</tr>
<tr>
<td>Command + A</td>
<td>移动光标到行首</td>
</tr>
<tr>
<td>Command + E</td>
<td>移动光标到行尾巴</td>
</tr>
<tr>
<td>Control + U</td>
<td>清除整行内容</td>
</tr>
<tr>
<td>Control + K</td>
<td>删除光标之后的内容</td>
</tr>
<tr>
<td>Control + C</td>
<td>Kill掉当前运行的程序</td>
</tr>
<tr>
<td>Control + Z</td>
<td>暂停当前运行程序，要恢复运行使用 <code>fg process_name</code></td>
</tr>
</tbody></table>
<h2 id="快捷键详细信息"><a href="#快捷键详细信息" class="headerlink" title="快捷键详细信息"></a>快捷键详细信息</h2><h3 id="Option-Left-or-Right"><a href="#Option-Left-or-Right" class="headerlink" title="Option + Left or Right"></a>Option + Left or Right</h3><p>如果使用iTerm2作为终端模拟器时，该快捷键不是所预想的功能，此时需要进行设置，这里贴出[4]提供的教程</p>
<p>Step 1: 在 Profiles-Keys 下设置 <code> Left ⌥ key to act as Esc+</code></p>
<img src="/2018/05/03/%E7%BB%88%E7%AB%AF%E5%BF%AB%E6%8D%B7%E9%94%AE/1.png" class="" width="800">

<p>Step 2: 添加一个快捷键 <code>⌥ ←</code>，快捷键设置内容为</p>
<ul>
<li>Keyboard Shortcut: <code>⌥ ←</code></li>
<li>Action: Send Escape Sequence</li>
<li>Esc+: b</li>
</ul>
<img src="/2018/05/03/%E7%BB%88%E7%AB%AF%E5%BF%AB%E6%8D%B7%E9%94%AE/2.png" class="" width="800">

<p>Step 3: 添加一个快捷键 <code>⌥ →</code>，快捷键设置内容为</p>
<ul>
<li>Keyboard Shortcut: <code>⌥ →</code></li>
<li>Action: Send Escape Sequence</li>
<li>Esc+: f</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://cnbin.github.io/blog/2015/06/20/iterm2-kuai-jie-jian-da-quan/">iTerm2 快捷键大全</a></li>
<li><a target="_blank" rel="noopener" href="https://www.howtogeek.com/howto/ubuntu/keyboard-shortcuts-for-bash-command-shell-for-ubuntu-debian-suse-redhat-linux-etc/">The Best Keyboard Shortcuts for Bash (aka the Linux and macOS Terminal)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.techrepublic.com/article/20-terminal-shortcuts-developers-need-to-know/">20 Terminal shortcuts developers need to know</a></li>
<li><a target="_blank" rel="noopener" href="https://coderwall.com/p/h6yfda/use-and-to-jump-forwards-backwards-words-in-iterm-2-on-os-x">Use ⌥ ← and ⌥→ to jump forwards &#x2F; backwards words in iTerm 2, on OS X</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/02/Python-Snippets-Part-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/02/Python-Snippets-Part-1/" class="post-title-link" itemprop="url">Python Snippets Part 1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-02 22:57:40" itemprop="dateCreated datePublished" datetime="2018-05-02T22:57:40+08:00">2018-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><a href="#1-%E5%88%A4%E6%96%AD%E6%96%87%E4%BB%B6%E6%88%96%E7%9B%AE%E5%BD%95%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">1. 判断文件或目录是否存在</a></li>
<li><a href="#2-parametergrid">2. ParameterGrid</a></li>
<li><a href="#3-%E6%89%B9%E9%87%8F%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87">3. 批量下载图片</a></li>
<li><a href="#4-%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6">4. 遍历文件夹中所有文件</a></li>
<li><a href="#5-%E8%AE%A1%E7%AE%97%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4">5. 计算函数运行时间</a></li>
<li><a href="#6-%E5%88%A4%E6%96%AD%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E5%8F%AF%E8%BF%AD%E4%BB%A3">6. 判断对象是否可迭代</a></li>
<li><a href="#7-%E5%88%A4%E6%96%AD%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%9E%8B">7. 判断操作系统类型</a></li>
</ul>
<h2 id="1-判断文件或目录是否存在"><a href="#1-判断文件或目录是否存在" class="headerlink" title="1. 判断文件或目录是否存在"></a>1. 判断文件或目录是否存在</h2><p>创建一个目录和一个文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> dir1 &amp;&amp; <span class="built_in">touch</span> file1.txt</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> -l</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 luowanqian  wheel  68  5  2 23:21 dir1</span><br><span class="line">-rw-r--r--  1 luowanqian  wheel   0  5  2 23:21 file1.txt</span><br></pre></td></tr></table></figure>

<p>使用 <code>os.path.exists()</code> 可以判断文件或目录是否存在，但是不能判断是该路径是一个文件还是目录，要进一步判断，需要使用 <code>os.path.isfile()</code>，如果该路径是一个文件，则返回 True，否则返回 False，当然，也可以直接使用 <code>os.path.isfile()</code> 判断文件是否存在。测试代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.exists(<span class="string">&#x27;dir1&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.exists(<span class="string">&#x27;file1.txt&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.isfile(<span class="string">&#x27;dir1&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.isfile(<span class="string">&#x27;file1.txt&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.exists(<span class="string">&#x27;dir2&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.exists(<span class="string">&#x27;file2.txt&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.isfile(<span class="string">&#x27;dir2&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.isfile(<span class="string">&#x27;file2.txt&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>目录 <code>dir2</code> 和文件 <code>file2.txt</code> 均不存在，所以函数 <code>os.path.exists()</code> 和 <code>os.path.isfile()</code> 均返回 False。</p>
<h2 id="2-ParameterGrid"><a href="#2-ParameterGrid" class="headerlink" title="2. ParameterGrid"></a>2. ParameterGrid</h2><p>机器学习算法最常见的调参方法是网格搜索，需要将多组参数进行组合，Scikit-learn提供了一个类 <code>ParametGrid</code> 可以生成所有的参数组合，这里提取其关键代码单独写成一个生成器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parameters_grid</span>(<span class="params">parameter_map</span>):</span><br><span class="line">    items = <span class="built_in">sorted</span>(parameter_map.items())</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> items:</span><br><span class="line">        <span class="keyword">yield</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        keys, values = <span class="built_in">zip</span>(*items)</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> product(*values):</span><br><span class="line">            params = <span class="built_in">dict</span>(<span class="built_in">zip</span>(keys, v))</span><br><span class="line">            <span class="keyword">yield</span> params</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parameter_map = &#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="literal">True</span>, <span class="literal">False</span>]&#125;</span><br><span class="line">    <span class="keyword">for</span> params <span class="keyword">in</span> parameters_grid(parameter_map):</span><br><span class="line">        <span class="built_in">print</span>(params)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>代码运行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: True&#125;</span><br><span class="line">&#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: False&#125;</span><br><span class="line">&#123;&#x27;a&#x27;: 2, &#x27;b&#x27;: True&#125;</span><br><span class="line">&#123;&#x27;a&#x27;: 2, &#x27;b&#x27;: False&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-批量下载图片"><a href="#3-批量下载图片" class="headerlink" title="3. 批量下载图片"></a>3. 批量下载图片</h2><p>这里使用<code>requests</code>库批量下载图片，为了加快下载速度，还实现了多线程下载，同时为了避免一次下载失败，脚本支持自动重试下载。没有处理具体的异常，只是捕获异常后输出异常信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> progressbar</span><br><span class="line"><span class="keyword">import</span> concurrent.futures <span class="keyword">as</span> concurrent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(<span class="params">stop_max_attempt_number=<span class="number">10</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">image_url, image_path</span>):</span><br><span class="line">    response = requests.get(image_url)</span><br><span class="line">    img = Image.<span class="built_in">open</span>(BytesIO(response.content))</span><br><span class="line">    img.save(image_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    base_url = <span class="string">&#x27;http://www.baidu.com&#x27;</span></span><br><span class="line">    num_images = <span class="number">3</span></span><br><span class="line">    suffix = <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">    image_dir = <span class="string">&#x27;images&#x27;</span></span><br><span class="line"></span><br><span class="line">    num_workers = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(image_dir):</span><br><span class="line">        os.mkdir(image_dir)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> concurrent.ThreadPoolExecutor(max_workers=num_workers) <span class="keyword">as</span> executor:</span><br><span class="line">        image_urls = []</span><br><span class="line">        image_paths = []</span><br><span class="line">        <span class="keyword">for</span> image_id <span class="keyword">in</span> <span class="built_in">range</span>(num_images):</span><br><span class="line">            url = base_url + <span class="string">&#x27;/&#x27;</span> + <span class="built_in">str</span>(image_id + <span class="number">1</span>) + suffix</span><br><span class="line">            file_path = os.path.join(image_dir, <span class="built_in">str</span>(image_id + <span class="number">1</span>) + suffix)</span><br><span class="line">            image_urls.append(url)</span><br><span class="line">            image_paths.append(file_path)</span><br><span class="line"></span><br><span class="line">        tasks = &#123;</span><br><span class="line">            executor.submit(download, url, file_path):</span><br><span class="line">                           (url, file_path) <span class="keyword">for</span> url, file_path <span class="keyword">in</span> <span class="built_in">zip</span>(image_urls, image_paths)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        total = <span class="built_in">len</span>(image_urls)</span><br><span class="line">        pbar = progressbar.ProgressBar(max_value=total).start()</span><br><span class="line">        <span class="keyword">for</span> task <span class="keyword">in</span> concurrent.as_completed(tasks):</span><br><span class="line">            url, file_path = tasks[task]</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                task.result()</span><br><span class="line">                i = i + <span class="number">1</span></span><br><span class="line">                pbar.update(i)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> exc:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125; generated an exception: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(url, exc))</span><br><span class="line">        pbar.finish()</span><br></pre></td></tr></table></figure>

<h2 id="4-遍历文件夹中所有文件"><a href="#4-遍历文件夹中所有文件" class="headerlink" title="4. 遍历文件夹中所有文件"></a>4. 遍历文件夹中所有文件</h2><p>首先目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tree test</span><br><span class="line">test</span><br><span class="line">├── 1.txt</span><br><span class="line">├── 2.txt</span><br><span class="line">└── test2</span><br><span class="line">    ├── 3.txt</span><br><span class="line">    └── 4.txt</span><br></pre></td></tr></table></figure>

<p>使用<code>os.walk()</code>遍历<code>test</code>目录，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root_dir = <span class="string">&#x27;/tmp/test&#x27;</span></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(root_dir, topdown=<span class="literal">True</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        <span class="built_in">print</span>(os.path.join(root, name))</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> dirs:</span><br><span class="line">        <span class="built_in">print</span>(os.path.join(root, name))</span><br></pre></td></tr></table></figure>

<p>得到结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/tmp/test/1.txt</span><br><span class="line">/tmp/test/2.txt</span><br><span class="line">/tmp/test/test2</span><br><span class="line">/tmp/test/test2/3.txt</span><br><span class="line">/tmp/test/test2/4.txt</span><br></pre></td></tr></table></figure>

<p>如果设置<code>topdown=False</code>，得到结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/tmp/test/test2/3.txt</span><br><span class="line">/tmp/test/test2/4.txt</span><br><span class="line">/tmp/test/1.txt</span><br><span class="line">/tmp/test/2.txt</span><br><span class="line">/tmp/test/test2</span><br></pre></td></tr></table></figure>

<h2 id="5-计算函数运行时间"><a href="#5-计算函数运行时间" class="headerlink" title="5. 计算函数运行时间"></a>5. 计算函数运行时间</h2><p>这里使用装饰器来计算函数运行时间</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timethis</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Decorator that reports the execution time</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(func.__name__, end-start)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@timethis</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">countdown</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        n -= <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="6-判断对象是否可迭代"><a href="#6-判断对象是否可迭代" class="headerlink" title="6. 判断对象是否可迭代"></a>6. 判断对象是否可迭代</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">isiterable</span>(<span class="params">obj</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        obj = <span class="built_in">iter</span>(obj)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    a = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    b = <span class="number">3</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;&#x27;a&#x27; is <span class="subst">&#123;<span class="string">&#x27;iterable&#x27;</span> <span class="keyword">if</span> isiterable(a) <span class="keyword">else</span> <span class="string">&#x27;not iterable&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;&#x27;b&#x27; is <span class="subst">&#123;<span class="string">&#x27;iterable&#x27;</span> <span class="keyword">if</span> isiterable(b) <span class="keyword">else</span> <span class="string">&#x27;not iterable&#x27;</span>&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;a&#x27; is iterable</span><br><span class="line">&#x27;b&#x27; is not iterable</span><br></pre></td></tr></table></figure>

<h2 id="7-判断操作系统类型"><a href="#7-判断操作系统类型" class="headerlink" title="7. 判断操作系统类型"></a>7. 判断操作系统类型</h2><p>可以使用 <code>sys.platform</code> 判断当前是什么操作系统。常见的操作系统，其返回值如下</p>
<table>
<thead>
<tr>
<th>System</th>
<th>platform value</th>
</tr>
</thead>
<tbody><tr>
<td>AIX</td>
<td><code>&#39;aix&#39;</code></td>
</tr>
<tr>
<td>Linux</td>
<td><code>&#39;linux&#39;</code></td>
</tr>
<tr>
<td>Windows</td>
<td><code>&#39;win32&#39;</code></td>
</tr>
<tr>
<td>Windows&#x2F;Cygwin</td>
<td><code>&#39;cygwin&#39;</code></td>
</tr>
<tr>
<td>macOS</td>
<td><code>&#39;darwin&#39;</code></td>
</tr>
</tbody></table>
<p>官方推荐使用 <code>startswith()</code> 判断系统类型 (见 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/sys.html#sys.platform">sys.platform</a>)，这里贴一段测试代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">identify_platform</span>():</span><br><span class="line">    platform = sys.platform</span><br><span class="line">    <span class="keyword">if</span> platform.startswith(<span class="string">&quot;freebsd&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;freebsd&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> platform.startswith(<span class="string">&quot;linux&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;linux&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> platform.startswith(<span class="string">&quot;aix&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;aix&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> platform.startswith(<span class="string">&quot;win&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;windows&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> platform.startswith(<span class="string">&quot;darwin&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;macos&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;unknown&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Platform: <span class="subst">&#123;identify_platform()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/04/30/VGG%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/30/VGG%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">VGG网络实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-30 15:39:03" itemprop="dateCreated datePublished" datetime="2018-04-30T15:39:03+08:00">2018-04-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="网络结构"><a href="#网络结构" class="headerlink" title="网络结构"></a>网络结构</h2><p>关于 VGG 的详细内容，可以去看论文 <a target="_blank" rel="noopener" href="https://arxiv.org/abs/1409.1556">Very Deep Convolutional Networks for Large-Scale Image Recognition</a>，这里贴出网络结构图。</p>
<img src="/2018/04/30/VGG%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0/vgg.png" class="" width="600">

<p>卷积层表示为 <code>conv&lt;receptive field size&gt;-&lt;number of channels&gt;</code>，卷积步长 (stride) 为 1，填充 (padding) 大小为 1，Pooling层的窗口大小为 2x2，步长 (stride) 为 2。为了显示简洁，图中未显示ReLU层。从图中可以看出网络输入的图片的大小为 224x224x3，经过每一层后，大小变化如下所示 (以下为VGG16网络，也就是图中的网络 D)</p>
<table>
<thead>
<tr>
<th align="left">网络层</th>
<th align="left">大小</th>
</tr>
</thead>
<tbody><tr>
<td align="left">输入层</td>
<td align="left">224x224x3</td>
</tr>
<tr>
<td align="left">conv3-64</td>
<td align="left">224x224x64</td>
</tr>
<tr>
<td align="left">conv3-64</td>
<td align="left">224x224x64</td>
</tr>
<tr>
<td align="left">maxpool</td>
<td align="left">112x112x64</td>
</tr>
<tr>
<td align="left">conv3-128</td>
<td align="left">112x112x128</td>
</tr>
<tr>
<td align="left">conv3-128</td>
<td align="left">112x112x128</td>
</tr>
<tr>
<td align="left">maxpool</td>
<td align="left">56x56x128</td>
</tr>
<tr>
<td align="left">conv3-256</td>
<td align="left">56x56x256</td>
</tr>
<tr>
<td align="left">conv3-256</td>
<td align="left">56x56x256</td>
</tr>
<tr>
<td align="left">conv3-256</td>
<td align="left">56x56x256</td>
</tr>
<tr>
<td align="left">maxpool</td>
<td align="left">28x28x256</td>
</tr>
<tr>
<td align="left">conv3-512</td>
<td align="left">28x28x512</td>
</tr>
<tr>
<td align="left">conv3-512</td>
<td align="left">28x28x512</td>
</tr>
<tr>
<td align="left">conv3-512</td>
<td align="left">28x28x512</td>
</tr>
<tr>
<td align="left">maxpool</td>
<td align="left">14x14x512</td>
</tr>
<tr>
<td align="left">conv3-512</td>
<td align="left">14x14x512</td>
</tr>
<tr>
<td align="left">conv3-512</td>
<td align="left">14x14x512</td>
</tr>
<tr>
<td align="left">conv3-512</td>
<td align="left">14x14x512</td>
</tr>
<tr>
<td align="left">maxpool</td>
<td align="left">7x7x512</td>
</tr>
<tr>
<td align="left">FC</td>
<td align="left">1x1x4096</td>
</tr>
<tr>
<td align="left">FC</td>
<td align="left">1x1x4096</td>
</tr>
<tr>
<td align="left">FC</td>
<td align="left">1x1x1000</td>
</tr>
</tbody></table>
<h2 id="PyTorch实现"><a href="#PyTorch实现" class="headerlink" title="PyTorch实现"></a>PyTorch实现</h2><p>VGG 网络的 PyTorch 实现可以在 <a target="_blank" rel="noopener" href="https://github.com/pytorch/vision/blob/master/torchvision/models/vgg.py">vgg.py</a> 中找到，里面实现了网络 <code>A, B, D, E</code> 即 VGG11, VGG13, VGG16 以及 VGG19，同时还有相对应的 Batch Normalization 版本。如果要将 VGG 网络应用到其他大小输入的图片，主要修改的参数就是最后几个全连接层的大小即可，也就是只用修改类 VGG 中 <code>classifier</code> 属性即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class VGG(nn.Module):</span><br><span class="line">	def __init__(self, features, num_classes=1000, init_weights=True):</span><br><span class="line">        super(VGG, self).__init__()</span><br><span class="line">        self.features = features</span><br><span class="line">        self.classifier = nn.Sequential(</span><br><span class="line">            nn.Linear(512 * 7 * 7, 4096),</span><br><span class="line">            nn.ReLU(True),</span><br><span class="line">            nn.Dropout(),</span><br><span class="line">            nn.Linear(4096, 4096),</span><br><span class="line">            nn.ReLU(True),</span><br><span class="line">            nn.Dropout(),</span><br><span class="line">            nn.Linear(4096, num_classes),</span><br><span class="line">        )</span><br><span class="line">        if init_weights:</span><br><span class="line">            self._initialize_weights()</span><br></pre></td></tr></table></figure>

<p>如果输入图片来自于CIFAR-10数据集，即大小为 32x32，类别数为10，经过网络的最后一个Pooling层后，输出大小为 1x1x512，因此修改类的 <code>classifier</code> 属性为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">self.classifier = nn.Sequential(</span><br><span class="line">    nn.Linear(512 * 1 * 1, 512),</span><br><span class="line">    nn.ReLU(True),</span><br><span class="line">    nn.Dropout(),</span><br><span class="line">    nn.Linear(512, 512),</span><br><span class="line">    nn.ReLU(True),</span><br><span class="line">    nn.Dropout(),</span><br><span class="line">    nn.Linear(512, num_classes),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>同时在使用函数生成对应版本的网络时，设置函数参数 <code>num_classes=10</code>。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="http://noahsnail.com/2017/08/17/2017-8-17-VGG%E8%AE%BA%E6%96%87%E7%BF%BB%E8%AF%91%E2%80%94%E2%80%94%E4%B8%AD%E6%96%87%E7%89%88/">VGG论文翻译——中文版</a></li>
<li><a target="_blank" rel="noopener" href="https://guanfuchen.github.io/post/markdown_blog_ws/markdown_blog_2017_11/pytorch%E5%AE%9E%E7%8E%B0%E7%9A%84vgg%E7%BD%91%E7%BB%9C/">Pytorch实现的Vgg网络</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/04/28/H5py%E6%94%AF%E6%8C%81Parallel-HDF5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/28/H5py%E6%94%AF%E6%8C%81Parallel-HDF5/" class="post-title-link" itemprop="url">H5py支持Parallel HDF5</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-28 23:14:06" itemprop="dateCreated datePublished" datetime="2018-04-28T23:14:06+08:00">2018-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>操作系统：OS X 10.11.6</p>
<p>Python版本：3.6.5</p>
<h2 id="安装HDF5"><a href="#安装HDF5" class="headerlink" title="安装HDF5"></a>安装HDF5</h2><p>使用 Homebrew 安装 HDF5，注意要开启 mpi 编译选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install hdf5 --with-mpi</span><br></pre></td></tr></table></figure>

<h2 id="安装mpi4py"><a href="#安装mpi4py" class="headerlink" title="安装mpi4py"></a>安装mpi4py</h2><p>官网教程在使用 Parallel HDF5 时会用到 mpi4py 这个包，直接使用 pip 安装即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install mpi4py</span><br></pre></td></tr></table></figure>

<p><strong>Note:</strong> 安装遇到一个问题是，如果之前安装过这个包，现在卸载再安装这个包时，pip 不会重新编译这个包，此时需要 <code>--no-cache-dir</code> 这个选项。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install --no-cache-dir mpi4py</span><br></pre></td></tr></table></figure>

<h2 id="安装h5py"><a href="#安装h5py" class="headerlink" title="安装h5py"></a>安装h5py</h2><p>直接使用 pip 安装 h5py 是不会开启 Parallel HDF5 的，需要添加一些编译选项，参考官网安装教程，运行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ export CC=mpicc</span><br><span class="line">$ export HDF5_MPI=&quot;ON&quot;</span><br><span class="line">$ pip3 install --no-binary=h5py h5py</span><br></pre></td></tr></table></figure>

<p>同前面所诉，如果需要重新编译这个包，需要用到 <code>--no-cache-dir</code> 这个选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install --no-cache-dir --no-binary=h5py h5py</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/04/28/%E5%9B%BE%E5%83%8F%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%E6%88%90LMDB%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/28/%E5%9B%BE%E5%83%8F%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%E6%88%90LMDB%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">图像数据转换成LMDB文件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-28 10:54:12" itemprop="dateCreated datePublished" datetime="2018-04-28T10:54:12+08:00">2018-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>在使用 Caffe 时，一个经常使用的数据输入来源就是LMDB数据库，通常我们手头的数据是一堆图片，此时需要将图片数据放入到LMDB数据库中。Caffe 有自个的转换程序，是一个用 C++ 编写的程序，需要编译，由于本文主要使用 Python语言，因此使用[3]提供的包来做数据转换。</p>
<p><strong>Note:</strong> 相关的代码和图片数据在 <a target="_blank" rel="noopener" href="https://github.com/luowanqian/CaffeTutorials/tree/master/LMDB">GitHub</a></p>
<h2 id="LMDB读写"><a href="#LMDB读写" class="headerlink" title="LMDB读写"></a>LMDB读写</h2><h3 id="数据描述"><a href="#数据描述" class="headerlink" title="数据描述"></a>数据描述</h3><p>已有 10 张图片，放在目录 <code>data</code> 中，图片文件名列表为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ls data | sort -n</span><br><span class="line">1.png</span><br><span class="line">2.png</span><br><span class="line">3.png</span><br><span class="line">4.png</span><br><span class="line">5.png</span><br><span class="line">6.png</span><br><span class="line">7.png</span><br><span class="line">8.png</span><br><span class="line">9.png</span><br><span class="line">10.png</span><br></pre></td></tr></table></figure>

<p>每张图片都有一个类别，存在文件 <code>labels.csv</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ cat labels.csv</span><br><span class="line">id,label</span><br><span class="line">1,frog</span><br><span class="line">2,truck</span><br><span class="line">3,truck</span><br><span class="line">4,deer</span><br><span class="line">5,automobile</span><br><span class="line">6,automobile</span><br><span class="line">7,bird</span><br><span class="line">8,horse</span><br><span class="line">9,ship</span><br><span class="line">10,cat</span><br></pre></td></tr></table></figure>

<p>文件中第一列是图片文件名 (不包含后缀名)，第二列是图片的类别。</p>
<h3 id="LMDB写入"><a href="#LMDB写入" class="headerlink" title="LMDB写入"></a>LMDB写入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import pandas as pd</span><br><span class="line">from skimage import io</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import os</span><br><span class="line">import lmdb</span><br><span class="line">import caffe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def make_datum(image, label, channels, height, width):</span><br><span class="line">    datum = caffe.proto.caffe_pb2.Datum()</span><br><span class="line">    datum.channels = channels</span><br><span class="line">    datum.label = int(label)</span><br><span class="line">    datum.height = height</span><br><span class="line">    datum.width = width</span><br><span class="line">    datum.data = image.tobytes()</span><br><span class="line"></span><br><span class="line">    return datum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># data path and lmdb path</span><br><span class="line">dataset_path = &#x27;./data&#x27;</span><br><span class="line">label_file = &#x27;labels.csv&#x27;</span><br><span class="line">lmdb_path = &#x27;cifar10_lmdb&#x27;</span><br><span class="line"></span><br><span class="line"># labels mapping</span><br><span class="line">labels_mapping = &#123;&#x27;airplane&#x27;: 0, &#x27;automobile&#x27;: 1,</span><br><span class="line">                  &#x27;bird&#x27;: 2, &#x27;cat&#x27;: 3, &#x27;deer&#x27;: 4, &#x27;dog&#x27;: 5,</span><br><span class="line">                  &#x27;frog&#x27;: 6, &#x27;horse&#x27;: 7, &#x27;ship&#x27;: 8, &#x27;truck&#x27;: 9&#125;</span><br><span class="line">classes = &#123;&#125;</span><br><span class="line">for key in labels_mapping:</span><br><span class="line">    classes[labels_mapping[key]] = key</span><br><span class="line"></span><br><span class="line"># load data</span><br><span class="line">df = pd.read_csv(label_file)</span><br><span class="line">df[&#x27;label&#x27;] = df[&#x27;label&#x27;].map(labels_mapping)</span><br><span class="line">images = list(df.id)</span><br><span class="line">labels = list(df.label)</span><br><span class="line"></span><br><span class="line"># write data to LMDB</span><br><span class="line">map_size = 1e6</span><br><span class="line">batch_size = 4</span><br><span class="line"></span><br><span class="line">count = 0</span><br><span class="line">lmdb_env = lmdb.open(lmdb_path, map_size=map_size)</span><br><span class="line">lmdb_txn = lmdb_env.begin(write=True)</span><br><span class="line"></span><br><span class="line">for image_id, label in zip(images, labels):</span><br><span class="line">    count = count + 1</span><br><span class="line">    image_file = os.path.join(dataset_path, str(image_id) + &#x27;.png&#x27;)</span><br><span class="line">    image = io.imread(image_file)</span><br><span class="line">    height, width, channels = image.shape</span><br><span class="line">    datum = make_datum(image, label, channels, height, width)</span><br><span class="line">    str_id = &#x27;&#123;:08&#125;&#x27;.format(count)</span><br><span class="line">    lmdb_txn.put(str_id, datum.SerializeToString())</span><br><span class="line"></span><br><span class="line">    if count % batch_size == 0:</span><br><span class="line">        lmdb_txn.commit()</span><br><span class="line">        lmdb_txn = lmdb_env.begin(write=True)</span><br><span class="line"></span><br><span class="line">lmdb_txn.commit()</span><br><span class="line">lmdb_env.close()</span><br></pre></td></tr></table></figure>

<h3 id="LMDB读取"><a href="#LMDB读取" class="headerlink" title="LMDB读取"></a>LMDB读取</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">lmdb_env = lmdb.open(lmdb_path)</span><br><span class="line">lmdb_txn = lmdb_env.begin()</span><br><span class="line">lmdb_cursor = lmdb_txn.cursor()</span><br><span class="line">datum = caffe.proto.caffe_pb2.Datum()</span><br><span class="line"></span><br><span class="line">count = 0</span><br><span class="line">for key, value in lmdb_cursor:</span><br><span class="line">    datum.ParseFromString(value)</span><br><span class="line">    label = datum.label</span><br><span class="line">    height = datum.height</span><br><span class="line">    width = datum.width</span><br><span class="line">    channels = datum.channels</span><br><span class="line">    data = datum.data</span><br><span class="line">    count = count + 1</span><br><span class="line"></span><br><span class="line">    if count == 2:</span><br><span class="line">        image = np.frombuffer(data, dtype=np.uint8)</span><br><span class="line">        image = np.reshape(image, (height, width, channels))</span><br><span class="line">        print(&#x27;Label: &#123;&#125;, Class: &#123;&#125;&#x27;.format(label, classes[label]))</span><br><span class="line">        plt.imshow(image)</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">print(&#x27;Number of items: &#123;&#125;&#x27;.format(count))</span><br><span class="line"></span><br><span class="line">lmdb_env.close()</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="http://deepdish.io/2015/04/28/creating-lmdb-in-python/">Creating an LMDB database in Python</a></li>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/twmht/ad0769dde3b1e1d002752207a207e6dc">Write mnist image to lmdb with python</a></li>
<li><a target="_blank" rel="noopener" href="https://lmdb.readthedocs.io/en/release/">lmdb</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/04/27/H5py%E5%A4%87%E5%BF%98%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/27/H5py%E5%A4%87%E5%BF%98%E5%BD%95/" class="post-title-link" itemprop="url">H5py备忘录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-27 17:32:59" itemprop="dateCreated datePublished" datetime="2018-04-27T17:32:59+08:00">2018-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文主要是记录一些h5py的使用方法。</p>
<p><strong>Note:</strong> 如果没有特别说明，<code>np</code> 指的是 <code>numpy</code>，代表导入的 numpy</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>

<h2 id="存储浮点数采用单精度浮点数"><a href="#存储浮点数采用单精度浮点数" class="headerlink" title="存储浮点数采用单精度浮点数"></a>存储浮点数采用单精度浮点数</h2><p>在HDF5文件中存储浮点数时，可以选择单精度浮点数和双精度浮点数，常见是用单精度浮点数来存储浮点数，相比于双精度浮点数，单精度浮点数存储空间为双精度浮点数的一半，这样可以缩小一半的存储空间。不同于文件存储，在内存中需要使用双精度浮点数来保证计算的准确性，因此一个通常的操作是，在内存中使用双精度浮点数，然后存储到HDF5文件时，使用单精度浮点数，两者的使用只需要进行数据类型转换。</p>
<p>在内存中，我们使用Numpy创建一个数组，数据类型为双精度浮点数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bigdata = np.ones((<span class="number">100</span>, <span class="number">1000</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bigdata.dtype</span><br><span class="line">dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bigdata.shape</span><br><span class="line">(<span class="number">100</span>, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p>直接使用赋值方式将数组存储到HDF5文件中，存储的浮点数为双精度浮点数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> h5py.File(<span class="string">&#x27;big1.hdf5&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f1:</span><br><span class="line"><span class="meta">... </span>    f1[<span class="string">&#x27;big&#x27;</span>] = bigdata</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1 = h5py.File(<span class="string">&#x27;big1.hdf5&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1[<span class="string">&#x27;big&#x27;</span>].dtype</span><br><span class="line">dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>文件大小为 783K</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> -lh big1.hdf5</span></span><br><span class="line">-rw-r--r--  1 luowanqian  staff   783K  4 29 10:44 big1.hdf5</span><br></pre></td></tr></table></figure>

<p>我们可以使用 <code>create_dataset</code> 函数来指定存储单精度浮点数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> h5py.File(<span class="string">&#x27;big2.hdf5&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f2:</span><br><span class="line"><span class="meta">... </span>    f2.create_dataset(<span class="string">&#x27;big&#x27;</span>, data=bigdata, dtype=np.float32)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2 = h5py.File(<span class="string">&#x27;big2.hdf5&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2[<span class="string">&#x27;big&#x27;</span>].dtype</span><br><span class="line">dtype(<span class="string">&#x27;float32&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>文件大小为 393K</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> -lh big2.hdf5</span></span><br><span class="line">-rw-r--r--  1 luowanqian  staff   393K  4 29 11:02 big2.hdf5</span><br></pre></td></tr></table></figure>

<h2 id="读取数据时进行数据转换"><a href="#读取数据时进行数据转换" class="headerlink" title="读取数据时进行数据转换"></a>读取数据时进行数据转换</h2><p>假设有个存储单精度浮点数的HDF5文件，我们想将数据读入到内存时是双精度浮点数。HDF5文件的数据如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> h5py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bigdata = np.ones((<span class="number">100</span>, <span class="number">1000</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> h5py.File(<span class="string">&#x27;big.hdf5&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    f.create_dataset(<span class="string">&#x27;big&#x27;</span>, data=bigdata, dtype=np.float32)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = h5py.File(<span class="string">&#x27;big.hdf5&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset = f[<span class="string">&#x27;big&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.dtype</span><br><span class="line">dtype(<span class="string">&#x27;float32&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.shape</span><br><span class="line">(<span class="number">100</span>, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<h3 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h3><p>使用 <code>np.empty</code> 创建一个空数组，然后使用 <code>read_direct</code> 函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>out = np.empty((<span class="number">100</span>, <span class="number">1000</span>), dtype=np.float64)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.read_direct(out)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>out.dtype</span><br><span class="line">dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>如果不想读取全部数据，可以设置函数 <code>read_direct</code> 的 <code>source_sel</code> 和 <code>dest_sel</code> 参数。假设要将 <code>dset[0, :]</code> 的数据读入到 <code>out[50, :]</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>out = np.empty((<span class="number">100</span>, <span class="number">1000</span>), dtype=np.float64)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.read_direct(out, source_sel=np.s_[<span class="number">0</span>, :], dest_sel=np.s_[<span class="number">50</span>, :])</span><br></pre></td></tr></table></figure>

<p>其中使用 <code>np.s_</code> 返回是 Numpy 的 <code>slice</code> 对象，该对象包含索引信息。如果省略 <code>dset_sel</code> 参数，则采用类似 Numpy 的广播规则进行赋值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>out = np.empty((<span class="number">100</span>, <span class="number">50</span>), dtype=np.float32)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dset.read_direct(out, source_sel=np.s_[:, <span class="number">0</span>:<span class="number">50</span>])</span><br></pre></td></tr></table></figure>

<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><p>如果要读取多次同样大小的数据时，使用 <code>read_direct</code> 可以节省很多时间，因为只需要申请一次空间，后面数据读入直接覆盖到这个空间。做一个Benchmark：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h5py</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> timeit <span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;test.hdf5&#x27;</span></span><br><span class="line">n = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line">f = h5py.File(filename, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">dset = f.create_dataset(<span class="string">&#x27;perftest&#x27;</span>, (n, n), dtype=np.float32)</span><br><span class="line">dset[:] = np.random.random(n)</span><br><span class="line">out = np.empty((n, <span class="number">500</span>), dtype=np.float32)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">time_simple</span>():</span><br><span class="line">    dset[:, <span class="number">0</span>:<span class="number">500</span>].mean(axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">time_direct</span>():</span><br><span class="line">    dset.read_direct(out, np.s_[:, <span class="number">0</span>:<span class="number">500</span>])</span><br><span class="line">    out.mean(axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Time simple: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(timeit(time_simple, number=<span class="number">500</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Time direct: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(timeit(time_direct, number=<span class="number">500</span>)))</span><br><span class="line"></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Time simple: 41.33699381200131</span><br><span class="line">Time direct: 39.005692337988876</span><br></pre></td></tr></table></figure>

<h3 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h3><p>使用 <code>Dataset.astype</code> 这个上下文管理器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> dset.astype(<span class="string">&#x27;float64&#x27;</span>):</span><br><span class="line"><span class="meta">... </span>    out = dset[...]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>out.shape</span><br><span class="line">(<span class="number">100</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>out.dtype</span><br><span class="line">dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>当然，也适合读取部分数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> dset.astype(<span class="string">&#x27;float64&#x27;</span>):</span><br><span class="line"><span class="meta">... </span>    out = dset[<span class="number">0</span>, :]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>out.dtype</span><br><span class="line">dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/04/25/Non-Maximum-Suppression/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/25/Non-Maximum-Suppression/" class="post-title-link" itemprop="url">Non-Maximum Suppression</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-25 22:03:48" itemprop="dateCreated datePublished" datetime="2018-04-25T22:03:48+08:00">2018-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Non-Maximum Suppression，简称NMS，在计算视觉领域有着非常重要的应用，主要应用在冗余的检测框的去除，例如在人脸检测应用中，检测出多个人脸框，此时需要去除冗余的检测框，保留最好的一个，还有在目标检测算法中会遇到一个物体有多个检测框，此时也需要去除冗余的检测框。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>利用参考[1]中提供的例子来简单阐述算法的流程。已知图片中有一辆汽车</p>
<img src="/2018/04/25/Non-Maximum-Suppression/car.png" class="" width="500">

<p>目标检测算法定位该汽车的位置时找出了一堆检测框，此时我们需要去除冗余的检测框。假设目标算法找到了6个检测框，而且算法还提供了每个框中内容属于汽车的概率或者得分 (在RCNN中，使用SVM计算检测框属于该类别的得分)，NMS方法首先根据得分大小对检测框进行排序，假设从小到大的排序为 <code>A, B, C, D, E, F</code>。</p>
<ol>
<li><p>从最大得分的检测框 <code>F</code> 开始，分别判断 <code>A~E</code> 与 <code>F</code> 的重叠度IoU是否大于某个设定的阈值。</p>
</li>
<li><p>假设检测框 <code>B、D</code> 与 <code>F</code>  的重叠度超过阈值，那么就抛弃 <code>B、D</code>，并将检测框 <code>F</code> 标记为要保留的检测框。</p>
</li>
<li><p>第2步去掉 <code>B</code> 和 <code>D</code> 后，剩余检测框 <code>A、C、E</code>，接着在剩下的检测框中选择得分最大检测框 <code>E</code>，然后判断 <code>E</code> 和 <code>A、C</code> 的重叠度，如果重叠度大于设定阈值，那就抛弃该检测框，否则留到下一轮的筛选过程，并将检测框 <code>E</code> 标记为要保留的检测框。</p>
</li>
</ol>
<p>重复步骤 3，直到剩余待筛选的框个数为 0。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>关于单类别的NMS的实现，网上已经有实现好的，这里贴出 Ross Girshick (RCNN提出者) 写的Python实现 <a target="_blank" rel="noopener" href="https://github.com/rbgirshick/py-faster-rcnn/blob/master/lib/nms/py_cpu_nms.py">py_cpu_nms.py</a>，并且加了个人的标注。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def py_cpu_nms(dets, thresh):</span><br><span class="line">    &quot;&quot;&quot;Pure Python NMS baseline.&quot;&quot;&quot;</span><br><span class="line">    x1 = dets[:, 0]</span><br><span class="line">    y1 = dets[:, 1]</span><br><span class="line">    x2 = dets[:, 2]</span><br><span class="line">    y2 = dets[:, 3]</span><br><span class="line">    scores = dets[:, 4]</span><br><span class="line"></span><br><span class="line">    # 每个框 (bounding box) 的面积</span><br><span class="line">    areas = (x2 - x1 + 1) * (y2 - y1 + 1)</span><br><span class="line">    # 根据得分 (score) 的大小进行降序排序</span><br><span class="line">    order = scores.argsort()[::-1]</span><br><span class="line"></span><br><span class="line">    keep = []</span><br><span class="line">    while order.size &gt; 0:</span><br><span class="line">        # 保留剩余框中得分最高的那个</span><br><span class="line">        i = order[0]</span><br><span class="line">        keep.append(i)</span><br><span class="line"></span><br><span class="line">        # 计算相交区域位置，左上以及右下</span><br><span class="line">        xx1 = np.maximum(x1[i], x1[order[1:]])</span><br><span class="line">        yy1 = np.maximum(y1[i], y1[order[1:]])</span><br><span class="line">        xx2 = np.minimum(x2[i], x2[order[1:]])</span><br><span class="line">        yy2 = np.minimum(y2[i], y2[order[1:]])</span><br><span class="line"></span><br><span class="line">        # 计算相交区域面积</span><br><span class="line">        w = np.maximum(0.0, xx2 - xx1 + 1)</span><br><span class="line">        h = np.maximum(0.0, yy2 - yy1 + 1)</span><br><span class="line"></span><br><span class="line">        # 计算IoU，即 重叠面积 / (框1面积 + 框2面积 - 重叠面积)</span><br><span class="line">        inter = w * h</span><br><span class="line">        ovr = inter / (areas[i] + areas[order[1:]] - inter)</span><br><span class="line"></span><br><span class="line">        # 保留IoU小于阈值的框</span><br><span class="line">        inds = np.where(ovr &lt;= thresh)[0]</span><br><span class="line"></span><br><span class="line">        # 因为ovr数组的长度比order长度小1，所以这里要将所有下标后移一位</span><br><span class="line">        order = order[inds + 1]</span><br><span class="line"></span><br><span class="line">    return keep</span><br></pre></td></tr></table></figure>

<p>关于该代码的使用，我写了一个简单的测试脚本，在 <a target="_blank" rel="noopener" href="https://github.com/luowanqian/MachineLearning/tree/master/Non-MaximumSuppression">GitHub</a>，测试了一张图片，实现效果如下：</p>
<img src="/2018/04/25/Non-Maximum-Suppression/nms.png" class="" width="500">

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/makefile/p/nms.html">非极大值抑制（Non-Maximum Suppression，NMS）</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Luo Wanqian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">80</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Luo Wanqian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
