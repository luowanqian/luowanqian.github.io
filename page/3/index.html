<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="袋熊的树洞">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="袋熊的树洞">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Luo Wanqian">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>袋熊的树洞</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">袋熊的树洞</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">日拱一卒，功不唐捐</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-diary">

    <a href="/diary" rel="section"><i class="fa fa-fw fa-calendar"></i>diary</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/03/ConfigSpace%E5%A4%87%E5%BF%98%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/03/ConfigSpace%E5%A4%87%E5%BF%98%E5%BD%95/" class="post-title-link" itemprop="url">ConfigSpace备忘录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-03 10:10:09" itemprop="dateCreated datePublished" datetime="2019-05-03T10:10:09+08:00">2019-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>ConfigSpace是一个用于管理算法参数空间的Python包，主要用于算法参数选择任务。一些AutoML库，例如<a target="_blank" rel="noopener" href="https://github.com/automl/SMAC3">SMAC3</a>、<a target="_blank" rel="noopener" href="https://github.com/automl/HpBandSter">BOHB</a>以及<a target="_blank" rel="noopener" href="https://github.com/automl/auto-sklearn">auto-sklearn</a>，会用到该包。项目主页为：<a target="_blank" rel="noopener" href="https://github.com/automl/ConfigSpace">https://github.com/automl/ConfigSpace</a>。</p>
<p>注明：本文章相关代码在<a target="_blank" rel="noopener" href="https://gist.github.com/luowanqian/5fd452f204b60a56e5297c96489ed6dc">Gist</a></p>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>使用ConfigSpace包时通常要创建一个参数空间实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import ConfigSpace as CS</span><br><span class="line">import ConfigSpace.hyperparameters as CSH</span><br><span class="line"></span><br><span class="line">cs = CS.ConfigurationSpace()</span><br></pre></td></tr></table></figure>

<p>这个参数空间集合实例<code>cs</code>包含所有参数的设置</p>
<h2 id="整数参数和浮点参数"><a href="#整数参数和浮点参数" class="headerlink" title="整数参数和浮点参数"></a>整数参数和浮点参数</h2><p>本节开始将介绍如何配置算法的参数空间，这里举例的算法为SVM分类算法，算法具体实现为<a target="_blank" rel="noopener" href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html">sklearn.svm.SVC</a>。由SVC类介绍可以知道两个参数：</p>
<ol>
<li><code>C</code>为惩罚参数，数据类型为浮点数，且$C \ge 0$</li>
<li><code>max_iter</code>为最大迭代次数，数据类型为整数</li>
</ol>
<p>假设要限定<code>C</code>的取值范围为$[0, 1]$以及<code>max_iter</code>的取值范围为$[10, 100]$，可以用<code>UniformFloatHyperparameter</code>和<code>UniformIntegerHyperparameter</code>设定参数范围</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">param_c = CSH.UniformFloatHyperparameter(name=&#x27;C&#x27;, lower=0, upper=1)</span><br><span class="line">param_max_iter = CSH.UniformIntegerHyperparameter(name=&#x27;max_iter&#x27;, lower=10, upper=100)</span><br></pre></td></tr></table></figure>

<p>设定完参数空间后，需要添加到参数空间集合实例<code>cs</code>中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cs.add_hyperparameter(param_c)</span><br><span class="line">cs.add_hyperparameter(param_max_iter)</span><br></pre></td></tr></table></figure>

<p>此时可以使用<code>cs</code>的<code>sample_configuration</code>方法进行采样获得一组随机的参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cs.sample_configuration()</span><br></pre></td></tr></table></figure>

<p>此时输出类似下面这种情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Configuration:</span><br><span class="line">  C, Value: 0.7114185317566737</span><br><span class="line">  max_iter, Value: 84</span><br></pre></td></tr></table></figure>

<h2 id="Categorical参数和参数之间的联系"><a href="#Categorical参数和参数之间的联系" class="headerlink" title="Categorical参数和参数之间的联系"></a>Categorical参数和参数之间的联系</h2><p>由<code>sklearn.svm.SVC</code>类介绍可知，算法核类型由参数<code>kernel</code>控制 </p>
<ul>
<li><code>kernel</code>限定算法的核类型，取值主要有<code>&#39;linear&#39;</code>，<code>&#39;poly&#39;</code>，<code>&#39;rbf&#39;</code>，<code>&#39;sigmoid&#39;</code></li>
</ul>
<p>此时可以用<code>CategoricalHyperparameter</code>来代表参数<code>kernel</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">param_kernel = CSH.CategoricalHyperparameter(name=&#x27;kernel&#x27;, choices=[&#x27;linear&#x27;, &#x27;poly&#x27;, &#x27;rbf&#x27;, &#x27;sigmoid&#x27;])</span><br><span class="line"></span><br><span class="line">cs.add_hyperparameter(param_kernel)</span><br></pre></td></tr></table></figure>

<p>每一种核还有相应的参数设置（设定SVC类对应的参数），即</p>
<ul>
<li>Linear核$K(x, y)&#x3D;x^Ty$，无参数</li>
<li>Poly核$K(x, y)&#x3D;(\gamma x^Ty + r)^d$，其中参数$\gamma$对应<code>gamma</code>，参数$r$对应<code>coef0</code>，参数$d$对应<code>degree</code></li>
<li>RBF核$K(x, y)&#x3D;\exp(-\gamma \Vert x - y\Vert^2)$，其中参数$\gamma$对应<code>gamma</code></li>
<li>Sigmoid核$K(x, y)&#x3D;\tanh(\gamma x^T y + r)$，其中参数$\gamma$对应<code>gamma</code>，参数$r$对应<code>coef0</code></li>
</ul>
<p>首先创建参数<code>degree</code>、<code>coef0</code>以及<code>gamma</code>的参数空间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">param_degree = CSH.UniformIntegerHyperparameter(name=&#x27;degree&#x27;, lower=2, upper=4)</span><br><span class="line">param_coef0 = CSH.UniformFloatHyperparameter(name=&#x27;coef0&#x27;, lower=0, upper=1)</span><br><span class="line">param_gamma = CSH.UniformFloatHyperparameter(name=&#x27;gamma&#x27;, lower=1e-5, upper=1e2)</span><br><span class="line"></span><br><span class="line">cs.add_hyperparameters([param_degree, param_coef0, param_gamma])</span><br></pre></td></tr></table></figure>

<p>有前面的描述可以知道不同的核对应不同的参数，也就是说核参数和核类型参数之间是由关联的</p>
<ul>
<li>参数<code>degree</code>关联Poly核</li>
<li>参数<code>coef0</code>关联Poly核和Sigmoid核</li>
<li>参数<code>gamma</code>关联Poly核、RBF核和Sigmoid核</li>
</ul>
<p>要想表示这种参数之间的关系，可以使用<code>EqualsCondition</code>以及<code>OrConjunction</code>，即</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cond1 = CS.EqualsCondition(param_degree, param_kernel, &#x27;poly&#x27;)</span><br><span class="line">cond2 = CS.OrConjunction(CS.EqualsCondition(param_coef0, param_kernel, &#x27;poly&#x27;),</span><br><span class="line">                         CS.EqualsCondition(param_coef0, param_kernel, &#x27;sigmoid&#x27;))</span><br><span class="line">cond3 = CS.OrConjunction(CS.EqualsCondition(param_gamma, param_kernel, &#x27;rbf&#x27;),</span><br><span class="line">                         CS.EqualsCondition(param_gamma, param_kernel, &#x27;poly&#x27;),</span><br><span class="line">                         CS.EqualsCondition(param_gamma, param_kernel, &#x27;sigmoid&#x27;))</span><br><span class="line"></span><br><span class="line">cs.add_conditions([cond1, cond2, cond3])</span><br></pre></td></tr></table></figure>

<p>其中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CS.EqualsCondition(param_degree, param_kernel, &#x27;poly&#x27;)</span><br></pre></td></tr></table></figure>

<p>意思为参数<code>kernel</code>值为<code>&#39;poly&#39;</code>时，设定参数<code>degree</code>的值。如果有多个条件，需要用<code>OrConjunction</code>来OR这些条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cond2 = CS.OrConjunction(CS.EqualsCondition(param_coef0, param_kernel, &#x27;poly&#x27;),</span><br><span class="line">                         CS.EqualsCondition(param_coef0, param_kernel, &#x27;sigmoid&#x27;))</span><br></pre></td></tr></table></figure>

<p>意思为当参数<code>kernel</code>值为<code>&#39;poly&#39;</code>时，设定参数<code>coef0</code>值，或者当参数<code>kernel</code>值为<code>&#39;sigmoid&#39;</code>时，设定参数<code>coef0</code>值。</p>
<h2 id="禁止参数取值组合出现"><a href="#禁止参数取值组合出现" class="headerlink" title="禁止参数取值组合出现"></a>禁止参数取值组合出现</h2><p>前面我们设定了<code>sklearn.svm.SVC</code>类某些参数的参数空间，假如SVC的核选择的是Linear核，即参数<code>kernel</code>取值为<code>&#39;Linear&#39;</code>，此时SVM变成了LinearSVM。如果SVC类的LinearSVM实现为<a target="_blank" rel="noopener" href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.LinearSVC.html">sklearn.svm.LinearSVC</a>，这时可以用LinearSVC类参数进一步控制算法的运行过程。<br><code>注：这里只是假设一种情况，即SVC类有LinearSVC类的全部参数，真实情况是SVC类并没有LinearSVC类的全部参数。</code></p>
<p>LinearSVC类部分参数如下</p>
<ul>
<li><code>penalty</code>设置正则项类型，数据类型为字符串，取值为<code>&#39;l1&#39;</code>或者<code>&#39;l2&#39;</code></li>
<li><code>loss</code>设置损失函数类型，数据类型为字符串，取值为<code>&#39;hinge&#39;</code>或者<code>&#39;squared_hinge&#39;</code></li>
<li><code>dual</code>设置算法是否求解对偶问题，数据类型为布尔值，实际可以替换成字符串类型</li>
</ul>
<p>首先根据这三个参数设置参数空间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">param_penalty = CSH.CategoricalHyperparameter(name=&#x27;penalty&#x27;, choices=[&#x27;l1&#x27;, &#x27;l2&#x27;], default_value=&#x27;l2&#x27;)</span><br><span class="line">param_loss = CSH.CategoricalHyperparameter(name=&#x27;loss&#x27;, choices=[&#x27;hinge&#x27;, &#x27;squared_hinge&#x27;], default_value=&#x27;squared_hinge&#x27;)</span><br><span class="line">param_dual = CSH.CategoricalHyperparameter(name=&#x27;dual&#x27;, choices=[&#x27;True&#x27;,&#x27;False&#x27;], default_value=&#x27;False&#x27;)</span><br><span class="line"></span><br><span class="line">cs.add_hyperparameters([param_penalty, param_loss, param_dual])</span><br></pre></td></tr></table></figure>

<p>当核类型为Linear核时，这三个参数才会被设置，因此要进行参数关联</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cond1 = CS.EqualsCondition(param_penalty, param_kernel, &#x27;linear&#x27;)</span><br><span class="line">cond2 = CS.EqualsCondition(param_loss, param_kernel, &#x27;linear&#x27;)</span><br><span class="line">cond3 = CS.EqualsCondition(param_dual, param_kernel, &#x27;linear&#x27;)</span><br><span class="line"></span><br><span class="line">cs.add_conditions([cond1, cond2, cond3])</span><br></pre></td></tr></table></figure>

<p>这里限定一些参数组合不能出现</p>
<ul>
<li>参数<code>penalty</code>取值<code>&#39;l1&#39;</code>，参数<code>loss</code>取值<code>&#39;hinge&#39;</code></li>
<li>参数<code>dual</code>取值<code>&#39;False&#39;</code>，参数<code>penalty</code>取值<code>&#39;l2&#39;</code>，参数<code>loss</code>取值<code>&#39;hinge&#39;</code></li>
<li>参数<code>dual</code>取值<code>&#39;False&#39;</code>，参数<code>&#39;penalty&#39;</code>取值<code>&#39;l1&#39;</code></li>
</ul>
<p>要禁止出现某些参数组合，可以使用<code>ForbiddenEqualsClause</code>，如果有多个组合，需要使用<code>ForbiddenAndConjunction</code>进行OR</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">penalty_loss = CS.ForbiddenAndConjunction(</span><br><span class="line">        CS.ForbiddenEqualsClause(param_penalty, &#x27;l2&#x27;),</span><br><span class="line">        CS.ForbiddenEqualsClause(param_loss, &#x27;hinge&#x27;)</span><br><span class="line">)</span><br><span class="line">dual_penalty_loss = CS.ForbiddenAndConjunction(</span><br><span class="line">        CS.ForbiddenEqualsClause(param_dual, &#x27;False&#x27;),</span><br><span class="line">        CS.ForbiddenEqualsClause(param_penalty, &#x27;l2&#x27;),</span><br><span class="line">        CS.ForbiddenEqualsClause(param_loss, &#x27;hinge&#x27;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">penalty_dual = CS.ForbiddenAndConjunction(</span><br><span class="line">        CS.ForbiddenEqualsClause(param_dual, &#x27;False&#x27;),</span><br><span class="line">        CS.ForbiddenEqualsClause(param_penalty, &#x27;l1&#x27;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">cs.add_forbidden_clause(penalty_loss)</span><br><span class="line">cs.add_forbidden_clause(dual_penalty_loss)</span><br><span class="line">cs.add_forbidden_clause(penalty_dual)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/01/Ubuntu18-04%E5%AE%89%E8%A3%85VNC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/01/Ubuntu18-04%E5%AE%89%E8%A3%85VNC/" class="post-title-link" itemprop="url">Ubuntu18.04安装VNC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-01 19:37:36" itemprop="dateCreated datePublished" datetime="2019-05-01T19:37:36+08:00">2019-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装桌面环境和VNC服务端"><a href="#安装桌面环境和VNC服务端" class="headerlink" title="安装桌面环境和VNC服务端"></a>安装桌面环境和VNC服务端</h2><p>首先更新包列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>安装桌面环境Xfce</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install xfce4 xfce4-goodies</span><br></pre></td></tr></table></figure>

<p>安装VNC服务端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install tightvncserver</span><br></pre></td></tr></table></figure>

<h2 id="设置VNC连接密码设置以及生成配置文件"><a href="#设置VNC连接密码设置以及生成配置文件" class="headerlink" title="设置VNC连接密码设置以及生成配置文件"></a>设置VNC连接密码设置以及生成配置文件</h2><p>首先执行<code>vncserver</code>命令来设置VNC连接密码以及生成VNC配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vncserver</span><br></pre></td></tr></table></figure>

<p>执行命令后会要求设置连接密码，显示以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">You will require a password to access your desktops.</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">Verify:</span><br></pre></td></tr></table></figure>

<p>设置完密码后，命令会生成VNC配置文件并启动一个VNC实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">New &#x27;X&#x27; desktop is your_hostname:1</span><br><span class="line"></span><br><span class="line">Creating default startup script /home/your_username/.vnc/xstartup</span><br><span class="line">Starting applications specified in /home/your_username/.vnc/xstartup</span><br><span class="line">Log file is /home/your_username/.vnc/your_hostname:1.log</span><br></pre></td></tr></table></figure>

<p>配置文件在下面目录里面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/your_username/.vnc/</span><br></pre></td></tr></table></figure>

<p>第一次运行<code>vncserver</code>命令会自动启动VNC实例，分配到<code>:1</code>上，对应端口为5901 (端口5901&#x3D;5900+1，如果是<code>:2</code>，则端口为5902，以此类推)。由于要配置VNC，所以先要关闭VNC实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vncserver -kill :1</span><br></pre></td></tr></table></figure>

<p>关闭成功后会显示以下信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Killing Xtightvnc process ID 30095</span><br></pre></td></tr></table></figure>

<h2 id="配置VNC"><a href="#配置VNC" class="headerlink" title="配置VNC"></a>配置VNC</h2><p>要配置的文件为<code>xstartup</code>，该文件在<code>$HOME/.vnc</code>里面，即</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/your_username/.vnc/</span><br></pre></td></tr></table></figure>

<p>首先备份原始配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mv ~/.vnc/xstartup ~/.vnc/xstartup.bak</span><br></pre></td></tr></table></figure>

<p>然后创建新的配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch ~/.vnc/xstartup</span><br></pre></td></tr></table></figure>

<p>编辑该文件，添加以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">xrdb $HOME/.Xresources</span><br><span class="line">unset SESSION_MANAGER</span><br><span class="line">unset DBUS_SESSION_BUS_ADDRESS</span><br><span class="line">startxfce4 &amp;</span><br></pre></td></tr></table></figure>

<p>网上很多教程会省略销毁那两个环境变量，即没有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unset SESSION_MANAGER</span><br><span class="line">unset DBUS_SESSION_BUS_ADDRESS</span><br></pre></td></tr></table></figure>

<p>我实际操作时发现如果没有销毁变量，连接上VNC时，画面是全灰的，销毁变量后，显示就正常了。为了保证VNC配置文件能够生效，赋予该文件执行权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x ~/.vnc/xstartup</span><br></pre></td></tr></table></figure>

<h2 id="VNC连接"><a href="#VNC连接" class="headerlink" title="VNC连接"></a>VNC连接</h2><p>启动VNC实例，即执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vncserver</span><br></pre></td></tr></table></figure>

<p>执行成功后，显示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">New &#x27;X&#x27; desktop is your_hostname:1</span><br><span class="line"></span><br><span class="line">Starting applications specified in /home/your_username/.vnc/xstartup</span><br><span class="line">Log file is /home/your_username/.vnc/your_hostname:1.log</span><br></pre></td></tr></table></figure>

<p>查看端口开启情况，可以看到<code>5901</code>端口已经开启了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ss -ltn</span><br></pre></td></tr></table></figure>

<p>此时可以用VNC连接该电脑了，连接地址格式为<code>ip:port</code></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>[1] <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-18-04">How to Install and Configure VNC on Ubuntu 18.04</a></p>
<p>[2] <a target="_blank" rel="noopener" href="https://linuxconfig.org/vnc-server-on-ubuntu-18-04-bionic-beaver-linux">VNC server on Ubuntu 18.04 Bionic Beaver Linux</a></p>
<p>[3] <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f58fe5cdeb5f">2018-06-07【Ubuntu 18.04 搭建VNC服务器】</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/19/%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90Kernel-Matrix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/19/%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90Kernel-Matrix/" class="post-title-link" itemprop="url">快速生成Kernel Matrix</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-19 19:55:46" itemprop="dateCreated datePublished" datetime="2019-04-19T19:55:46+08:00">2019-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>有些机器学习算法，比如最小二乘支持向量机 (Least Squares Support Vector Machine, LSSVM)，需要计算核矩阵 (Kernel Matrix)。核矩阵的定义如下</p>
<p>$$<br>\Omega &#x3D; K(X, Y) &#x3D; \begin{bmatrix}<br>K(x_1, y_1) &amp; K(x_1, y_2) &amp; \cdots &amp; K(x_1, y_n) \<br>K(x_2, y_1) &amp; K(x_2, y_2) &amp; \cdots &amp; K(x_2, y_n) \<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>K(x_m, y_1) &amp; K(x_n, y_2) &amp; \cdots &amp; K(x_m, y_n)<br>\end{bmatrix}<br>$$</p>
<p>其中$K(\cdot, \cdot)$为核函数，常见的有线性核以及RBF核，矩阵$X \in R^{m \times d}$和$Y \in R^{n \times d}$为数据矩阵，每一行代表一个样本，定义为</p>
<p>$$<br>\begin{aligned}<br>X &amp; &#x3D; [x_1 , x_2 , \cdots , x_m]^T \<br>Y &amp; &#x3D; [y_1 , y_2 , \cdots , y_n]^T<br>\end{aligned}<br>$$</p>
<p>核矩阵的规模为$m \times n$，可以看出核矩阵的规模是由数据个数决定的，如果按照定义一个个生成核矩阵每一个元素，可想而知生成效率会极其低下，因此考虑用其他方式快速生成核矩阵。</p>
<h2 id="快速生成核矩阵"><a href="#快速生成核矩阵" class="headerlink" title="快速生成核矩阵"></a>快速生成核矩阵</h2><p>本文只考虑核函数为RBF核的情况，其他情况有相类似的推导。RBF核又称高斯核，其定义为</p>
<p>$$<br>K(x, y) &#x3D; e^{-\frac{\Vert x - y \Vert^2}{2\sigma^2}}<br>$$</p>
<p>其中$\sigma &gt; 0$为高斯核带宽，$\Vert\cdot\Vert$为$L_2$范数。此时核矩阵$\Omega$为</p>
<p>$$<br>\Omega&#x3D;K(X, Y) &#x3D; \begin{bmatrix}<br>e^{-\frac{\Vert x_1 - y_1\Vert^2}{2\sigma^2}} &amp; e^{-\frac{\Vert x_1 - y_2 \Vert^2}{2\sigma^2}} &amp; \cdots &amp; e^{-\frac{\Vert x_1 - y_n \Vert^2}{2\sigma^2}} \<br>e^{-\frac{\Vert x_2 - y_1 \Vert^2}{2\sigma^2}} &amp; e^{-\frac{\Vert x_2 - y_2 \Vert^2}{2\sigma^2}} &amp; \cdots &amp; e^{-\frac{\Vert x_2 - y_n \Vert^2}{2\sigma^2}} \<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>e^{-\frac{\Vert x_m - y_1 \Vert^2}{2\sigma^2}} &amp; e^{-\frac{\Vert x_m - y_2 \Vert^2}{2\sigma^2}} &amp; \cdots &amp; e^{-\frac{\Vert x_m - y_n \Vert^2}{2\sigma^2}}<br>\end{bmatrix}<br>$$</p>
<p>将自然指数运算提取到矩阵外面，则核矩阵$\Omega$表示为$\Omega&#x3D;e^{-\frac{D}{2\sigma^2}}$，这里矩阵$D$为</p>
<p>$$<br>D &#x3D; \begin{bmatrix}<br>\Vert x_1 - y_1 \Vert^2 &amp; \Vert x_1 - y_2 \Vert^2 &amp; \cdots &amp; \Vert x_1 - y_n \Vert^2 \<br>\Vert x_2 - y_1 \Vert^2 &amp; \Vert x_2 - y_2 \Vert^2 &amp; \cdots &amp; \Vert x_2 - y_n \Vert^2 \<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>\Vert x_m - y_1 \Vert^2 &amp; \Vert x_m - y_2 \Vert^2 &amp; \cdots &amp; \Vert x_m - y_n \Vert^2<br>\end{bmatrix}<br>$$</p>
<p>将矩阵$D$中每一个元素展开，则可得</p>
<p>$$<br>\begin{aligned}<br>\Vert x_i - y_j \Vert^2 &amp; &#x3D; (x_i - y_j)^T(x_i - y_j) \<br>&amp; &#x3D; x_i^T x_i - 2 x_i^T y_j + y_j^T y_j \<br>&amp; &#x3D; \Vert x_i \Vert^2 - 2 x_i^T y_j + \Vert y_j \Vert^2<br>\end{aligned}<br>$$</p>
<p>从而矩阵$D$可以分解为三个矩阵之和</p>
<p>$$<br>D &#x3D; A - 2B + C<br>$$</p>
<p>其中矩阵$A$定义为</p>
<p>$$<br>A &#x3D; \begin{bmatrix}<br>\Vert x_1 \Vert^2 &amp; \Vert x_1 \Vert^2 &amp; \cdots &amp; \Vert x_1 \Vert^2 \<br>\Vert x_2 \Vert^2 &amp; \Vert x_2 \Vert^2 &amp; \cdots &amp; \Vert x_2 \Vert^2 \<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>\Vert x_m \Vert^2 &amp; \Vert x_m \Vert^2 &amp; \cdots &amp; \Vert x_m \Vert^2<br>\end{bmatrix}_{m \times n}<br>$$</p>
<p>这里定义一个向量$\alpha$，其第$i$个元素为数据矩阵$X$第$i$行所有元素平方和，即</p>
<p>$$<br>\alpha &#x3D; \begin{bmatrix}<br>\Vert x_1 \Vert^2 &amp; \Vert x_2 \Vert^2 &amp; \cdots &amp; \Vert x_m \Vert^2<br>\end{bmatrix}^T<br>$$</p>
<p>则矩阵$A$可以表示为</p>
<p>$$<br>\begin{aligned}<br>A &amp; &#x3D; \alpha 1^T \<br>&amp; &#x3D; \begin{bmatrix}<br>\Vert x_1 \Vert^2 \<br>\Vert x_2 \Vert^2 \<br>\vdots \<br>\Vert x_m \Vert^2<br>\end{bmatrix} \begin{bmatrix}<br>1 &amp; 1 &amp; \cdots &amp; 1<br>\end{bmatrix}<br>\end{aligned}<br>$$</p>
<p>矩阵$B$定义为</p>
<p>$$<br>B &#x3D; \begin{bmatrix}<br>x_1^T y_1 &amp; x_1^T y_2 &amp; \cdots &amp; x_1^T y_n \<br>x_2^T y_1 &amp; x_2^T y_2 &amp; \cdots &amp; x_2^T y_n \<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>x_m^T y_1 &amp; x_m^T y_2 &amp; \cdots &amp; x_m^T y_n<br>\end{bmatrix}_{m \times n}<br>$$</p>
<p>很容易可以知道矩阵$B$由数据矩阵$X$和$Y$相乘而得</p>
<p>$$<br>B &#x3D; XY^T<br>$$</p>
<p>矩阵$C$定义为</p>
<p>$$<br>C &#x3D; \begin{bmatrix}<br>\Vert y_1 \Vert^2 &amp; \Vert y_2 \Vert^2 &amp; \cdots &amp; \Vert y_n \Vert^2 \<br>\Vert y_1 \Vert^2 &amp; \Vert y_2 \Vert^2 &amp; \cdots &amp; \Vert y_n \Vert^2 \<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>\Vert y_1 \Vert^2 &amp; \Vert y_2 \Vert^2 &amp; \cdots &amp; \Vert y_n \Vert^2<br>\end{bmatrix}_{m \times n}<br>$$</p>
<p>类似地，这里定义一个向量$\beta$，其第$i$个元素为数据矩阵$Y$第$i$行所有元素平方和，即</p>
<p>$$<br>\beta &#x3D; \begin{bmatrix}<br>\Vert y_1 \Vert^2 &amp; \Vert y_2 \Vert &amp; \cdots &amp; \Vert y_n \Vert^2<br>\end{bmatrix}^T<br>$$</p>
<p>则矩阵$C$可以表示为</p>
<p>$$<br>\begin{aligned}<br>C &amp; &#x3D; 1 \beta^T \<br>&amp; &#x3D; \begin{bmatrix}<br>1 \<br>1 \<br>\vdots \<br>1<br>\end{bmatrix} \begin{bmatrix}<br>\Vert y_1 \Vert^2 &amp; \Vert y_2 \Vert &amp; \cdots &amp; \Vert y_n \Vert^2<br>\end{bmatrix}<br>\end{aligned}<br>$$</p>
<p>综上可以得到</p>
<p>$$<br>D &#x3D; \alpha 1^T - 2 XY^T + 1 \beta^T<br>$$</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="原始生成方法"><a href="#原始生成方法" class="headerlink" title="原始生成方法"></a>原始生成方法</h3><p>按照核矩阵定义，一个个生成矩阵每一个元素，实现代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def method1(X1, X2, sigma=1.0):</span><br><span class="line">    num_samples1, dims = X1.shape</span><br><span class="line">    num_samples2, dims = X2.shape</span><br><span class="line">    mat = np.empty((num_samples1, num_samples2))</span><br><span class="line">    </span><br><span class="line">    for i in range(num_samples1):</span><br><span class="line">        for j in range(num_samples2):</span><br><span class="line">            vec = X1[i, :] - X2[j, :]</span><br><span class="line">            mat[i, j] = np.exp(-0.5 / sigma**2 * np.dot(vec, vec))</span><br><span class="line">    </span><br><span class="line">    return mat</span><br></pre></td></tr></table></figure>

<h3 id="快速生成方法1"><a href="#快速生成方法1" class="headerlink" title="快速生成方法1"></a>快速生成方法1</h3><p>根据前面讨论，将核矩阵分解为一系列矩阵向量乘积，实现代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def method2(X1, X2, sigma=1.0):</span><br><span class="line">    X1_sum = np.sum(X1**2, axis=1)</span><br><span class="line">    X2_sum = np.sum(X2**2, axis=1)</span><br><span class="line">    mat1 = np.dot(np.reshape(X1_sum, (X1_sum.shape[0], 1)),</span><br><span class="line">                  np.ones((1, X2_sum.shape[0])))</span><br><span class="line">    mat2 = np.dot(np.ones((X1_sum.shape[0], 1)),</span><br><span class="line">                  np.reshape(X2_sum, (1, X2_sum.shape[0])))</span><br><span class="line">    mat = mat1 + mat2 - 2 * np.dot(X1, X2.T)</span><br><span class="line">    mat = np.exp(-0.5 / sigma**2 * mat)</span><br><span class="line">    </span><br><span class="line">    return mat</span><br></pre></td></tr></table></figure>

<h3 id="快速生成方法2"><a href="#快速生成方法2" class="headerlink" title="快速生成方法2"></a>快速生成方法2</h3><p>利用Numpy的广播机制，进一步提升核矩阵生成速度，实现代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def method3(X1, X2, sigma=1.0):</span><br><span class="line">    mat = np.sum(X1**2, 1).reshape(-1, 1) + np.sum(X2**2, 1) - 2 * np.dot(X1, X2.T)</span><br><span class="line">    mat = np.exp(-0.5 / sigma**2 * mat)</span><br><span class="line">    </span><br><span class="line">    return mat</span><br></pre></td></tr></table></figure>

<h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><p>实验代码在：<a target="_blank" rel="noopener" href="https://gist.github.com/luowanqian/d2f655a95f77dfe088fd626f72d78966">https://gist.github.com/luowanqian/d2f655a95f77dfe088fd626f72d78966</a></p>
<p>这里做一个简单的实验，比对各种方法的效率。实验的数据矩阵$X$大小为$1000 \times 100$，数据矩阵$Y$大小为$5000 \times 100$，实验结果如下</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>生成时间</th>
</tr>
</thead>
<tbody><tr>
<td>原始生成</td>
<td>25.1 s</td>
</tr>
<tr>
<td>快速生成1</td>
<td>132 ms</td>
</tr>
<tr>
<td>快速生成2</td>
<td>106 ms</td>
</tr>
</tbody></table>
<p>由结果可以看出，快速生成方法速度提升是极大的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/09/09/%E4%BF%9D%E5%AD%98%E5%92%8C%E6%81%A2%E5%A4%8DTmux%E4%BC%9A%E8%AF%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/09/%E4%BF%9D%E5%AD%98%E5%92%8C%E6%81%A2%E5%A4%8DTmux%E4%BC%9A%E8%AF%9D/" class="post-title-link" itemprop="url">保存和恢复Tmux会话</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-09 22:14:38" itemprop="dateCreated datePublished" datetime="2018-09-09T22:14:38+08:00">2018-09-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>使用Tmux时经常会遇到的一个问题，那就是系统重启时，Session会被清除，每次打开电脑都要重启建一个Session，然后创建一堆Window以及Pane，这极大地降低了Tmux使用效率，因此需要想一个办法能够保存Tmux的Session。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>该问题的解决方案是安装一个叫<code>Tmux Resurrect</code>的插件。Tmux要安装插件，可以通过<code>Tmux Plugin Manager</code>这个插件进行安装，该插件相当于一个插件管理系统，可以快速地安装、更新以及删除插件。</p>
<h3 id="Tmux-Plugin-Manager"><a href="#Tmux-Plugin-Manager" class="headerlink" title="Tmux Plugin Manager"></a>Tmux Plugin Manager</h3><p>安装<code>Tmux Plugin Manager</code>插件可以参考该插件的GitHub：<a target="_blank" rel="noopener" href="https://github.com/tmux-plugins/tpm">tmux-plugins&#x2F;tpm</a>。安装很简单，首先clone插件到本地</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm</span></span><br></pre></td></tr></table></figure>

<p>然后修改<code>.tmux.conf</code>，在文件最底部添加以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># List of plugins</span><br><span class="line">set -g @plugin &#x27;tmux-plugins/tpm&#x27;</span><br><span class="line">set -g @plugin &#x27;tmux-plugins/tmux-sensible&#x27;</span><br><span class="line"></span><br><span class="line"># Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)</span><br><span class="line">run &#x27;~/.tmux/plugins/tpm/tpm&#x27;</span><br></pre></td></tr></table></figure>

<p>重新加载配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">type</span> this <span class="keyword">in</span> terminal <span class="keyword">if</span> tmux is already running</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tmux <span class="built_in">source</span> ~/.tmux.conf</span></span><br></pre></td></tr></table></figure>

<p>然后就可以在Tmux中使用快捷<code>prefix + I</code>(注意这里的<code>I</code>是大写)安装配置文件<code>.tmux.conf</code>中定义的插件了。</p>
<p><strong>补充：</strong></p>
<p>如果Tmux安装了<a target="_blank" rel="noopener" href="https://github.com/gpakosz/.tmux">gpakosz&#x2F;.tmux</a>，在文件<code>.tmux.conf.local</code>中配置好<code>Tmux Plugin Manager</code>后，在Tmux中使用<code>prefix + I</code>安装插件会没有效果，相关的讨论见<a target="_blank" rel="noopener" href="https://github.com/gpakosz/.tmux/issues/61">“run ‘~&#x2F;.tmux&#x2F;plugins&#x2F;tpm&#x2F;tpm’” has no effect in .tmux.conf.local #61</a>，具体的解决方案是用另一种写法写<code>set -g @plugin</code>，即将</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set -g @plugin &#x27;tmux-plugins/tpm&#x27;</span><br><span class="line">set -g @plugin &#x27;tmux-plugins/tmux-sensible&#x27;</span><br></pre></td></tr></table></figure>

<p>改写为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set -g @tpm_plugins &#x27;          \</span><br><span class="line">  tmux-plugins/tpm             \</span><br><span class="line">  tmux-plugins/tmux-sensible</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>解决方案来源于：<a target="_blank" rel="noopener" href="https://github.com/tmux-plugins/tpm/blob/master/docs/tpm_not_working.md">Help, tpm not working!</a></p>
<h2 id="Tmux-Resurrect"><a href="#Tmux-Resurrect" class="headerlink" title="Tmux Resurrect"></a>Tmux Resurrect</h2><p>安装好<code>Tmux Plugin Manager</code>后，就可以安装<code>Tmux Resurrect</code>插件(<a target="_blank" rel="noopener" href="https://github.com/tmux-plugins/tmux-resurrect">tmux-plugins&#x2F;tmux-resurrect</a>)了。在Tmux配置文件<code>.tmux.conf</code>中添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set -g @plugin &#x27;tmux-plugins/tmux-resurrect&#x27;</span><br></pre></td></tr></table></figure>

<p>然后使用快捷键<code>prefix + I</code>就可以安装插件了。</p>
<h2 id="保存和恢复"><a href="#保存和恢复" class="headerlink" title="保存和恢复"></a>保存和恢复</h2><p>安装完<code>Tmux Plugin Manager</code>，就可以使用下面快捷键保存和恢复Session了。</p>
<ul>
<li><code>prefix + Ctrl-s</code> - save</li>
<li><code>prefix + Ctrl-r</code> - restore</li>
</ul>
<p>平常重启电脑后，首先在终端打开Tmux，然后使用<code>prefix + Ctrl-r</code>就可以恢复保存的Session了，如果有多个Session可以使用<code>prefix + s</code>来选择Session。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://liam0205.me/2016/09/10/tmux-plugin-resurrect/">保存和恢复 Tmux 会话</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/09/03/Cython%E8%B0%83%E7%94%A8BLAS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/03/Cython%E8%B0%83%E7%94%A8BLAS/" class="post-title-link" itemprop="url">Cython调用BLAS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-03 23:21:59" itemprop="dateCreated datePublished" datetime="2018-09-03T23:21:59+08:00">2018-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>看本文之前建议看文章”<a target="_blank" rel="noopener" href="http://docs.cython.org/en/latest/src/userguide/memoryviews.html">Typed Memoryviews</a>“，该文章主要介绍的是<code>Memoryviews</code>，使用<code>Memoryviews</code>可以直接访问Numpy数组的memory buffer，直接操作Numpy数组的数据，同时是连接C数组与Numpy数组之间的桥梁。相关代码在：<a target="_blank" rel="noopener" href="https://github.com/luowanqian/CythonDemos/tree/master/Demo1">CythonDemos&#x2F;Demo1</a></p>
<h2 id="BLAS"><a href="#BLAS" class="headerlink" title="BLAS"></a>BLAS</h2><p><a target="_blank" rel="noopener" href="http://www.netlib.org/blas/">BLAS</a>，全称Basic Linear Algebra Subprograms，即基础线性代数子程序库，里面有大量已经编写好的关于线性代数运算的程序。BLAS库的API分三大类，分别为<code>Level 1</code>、<code>Level 2</code>以及<code>Level 3</code>。</p>
<ul>
<li>Level 1: 函数处理单一向量的线性运算以及两个向量的二元运算</li>
<li>Level 2: 函数处理矩阵与向量的运算，同时也包含线性方程组求解</li>
<li>Level 3: 函数处理矩阵与矩阵之间的运算</li>
</ul>
<p>API的全部介绍可以参考官方文档：<a target="_blank" rel="noopener" href="http://www.netlib.org/blas/blasqr.pdf">blasqr.pdf</a></p>
<h2 id="Cython调用BLAS函数"><a href="#Cython调用BLAS函数" class="headerlink" title="Cython调用BLAS函数"></a>Cython调用BLAS函数</h2><p>Cython要调用BLAS函数，主要是通过BLAS库的C接口，接口的具体定义可以参考现有BLAS库的 <a target="_blank" rel="noopener" href="https://github.com/xianyi/OpenBLAS/blob/develop/cblas.h">cblas.h</a>，里面函数的命名和 <a target="_blank" rel="noopener" href="http://www.netlib.org/blas/blasqr.pdf">blasqr.pdf</a> 中函数命名是一一对应的，只不过函数前多了<code>cblas_</code>前缀。这里演示如何调用函数<code>cblas_dgemv</code>，在头文件  <a target="_blank" rel="noopener" href="https://github.com/xianyi/OpenBLAS/blob/develop/cblas.h">cblas.h</a> 中函数声明为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">cblas_dgemv</span><span class="params">(OPENBLAS_CONST <span class="keyword">enum</span> CBLAS_ORDER order, OPENBLAS_CONST <span class="keyword">enum</span> CBLAS_TRANSPOSE trans, OPENBLAS_CONST blasint m, OPENBLAS_CONST blasint n, OPENBLAS_CONST <span class="type">double</span> alpha, OPENBLAS_CONST <span class="type">double</span> *a, OPENBLAS_CONST blasint lda, OPENBLAS_CONST <span class="type">double</span> *x, OPENBLAS_CONST blasint incx, OPENBLAS_CONST <span class="type">double</span> beta, <span class="type">double</span> *y, OPENBLAS_CONST blasint incy)</span>;</span><br></pre></td></tr></table></figure>

<p>去除一些宏以及替换定义的数据类型，简单表示就是</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">cblas_dgemv</span><span class="params">(<span class="keyword">enum</span> CBLAS_ORDER order, <span class="keyword">enum</span> CBLAS_TRANSPOSE trans, <span class="type">int</span> m, <span class="type">int</span> n, <span class="type">double</span> alpha, <span class="type">double</span> *a, <span class="type">int</span> lda, <span class="type">double</span> *x, <span class="type">int</span> incx, <span class="type">double</span> beta, <span class="type">double</span> *y, <span class="type">int</span> incy)</span></span><br></pre></td></tr></table></figure>

<p>这个函数主要是实现的功能计算矩阵与向量相乘，在 <a target="_blank" rel="noopener" href="http://www.netlib.org/blas/blasqr.pdf">blasqr.pdf</a> 中对应的是<code>Level2</code>中<code>xGEMV</code>函数</p>
<p>$$<br>y &#x3D; \alpha Ax + \beta y<br>$$</p>
<p>在Cython调用BLAS函数首先要使用<code>cdef extern</code>引入头文件，然后声明函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cdef <span class="keyword">extern</span> from <span class="string">&#x27;cblas.h&#x27;</span>:</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">CBLAS_ORDER</span>:</span></span><br><span class="line">        CblasRowMajor=<span class="number">101</span></span><br><span class="line">        CblasColMajor=<span class="number">102</span></span><br><span class="line">    <span class="keyword">enum</span> CBLAS_TRANSPOSE:</span><br><span class="line">        CblasNoTrans=<span class="number">111</span></span><br><span class="line">        CblasTrans=<span class="number">112</span></span><br><span class="line">        CblasConjTrans=<span class="number">113</span></span><br><span class="line">        CblasConjNoTrans=<span class="number">114</span></span><br><span class="line">    <span class="type">void</span> dgemv <span class="string">&quot;cblas_dgemv&quot;</span>(CBLAS_ORDER Order, CBLAS_TRANSPOSE TransA,</span><br><span class="line">                             <span class="type">int</span> M, <span class="type">int</span> N, <span class="type">double</span> alpha, <span class="type">double</span> *A, <span class="type">int</span> lda,</span><br><span class="line">                             <span class="type">double</span> *X, <span class="type">int</span> incX, <span class="type">double</span> beta,</span><br><span class="line">                             <span class="type">double</span> *Y, <span class="type">int</span> incY) nogil</span><br></pre></td></tr></table></figure>

<p>关于<code>enum</code>中<code>CblasRowMajor</code>这些标识符的取值，是按照 <a target="_blank" rel="noopener" href="https://github.com/xianyi/OpenBLAS/blob/develop/cblas.h">cblas.h</a> 中定义来取值。函数声明后就可以编写一个wrapper函数来调用BLAS函数，之所以要写一个wrapper函数，是因为声明的BLAS函数只能在C中进行调用，我们还要使得其能够在Python中进行调用，wrapper函数定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cpdef <span class="title function_">blas_dgemv</span><span class="params">(<span class="type">double</span>[:, ::<span class="number">1</span>] A, <span class="type">double</span>[::<span class="number">1</span>] x, <span class="type">double</span>[::<span class="number">1</span>] y,</span></span><br><span class="line"><span class="params">                 <span class="type">int</span> M, <span class="type">int</span> N, <span class="type">double</span> alpha, <span class="type">double</span> beta)</span>:</span><br><span class="line">    cdef <span class="type">double</span> *A_ptr = &amp;A[<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    cdef <span class="type">double</span> *x_ptr = &amp;x[<span class="number">0</span>]</span><br><span class="line">    cdef <span class="type">double</span> *y_ptr = &amp;y[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    dgemv(CblasRowMajor, CblasNoTrans, M, N,</span><br><span class="line">          alpha, A_ptr, N, x_ptr, <span class="number">1</span>, beta, y_ptr, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>通过<code>cpdef</code>可以使得定义的函数可以被Python调用。这里说一下如何将<code>MemoryViews</code>转化成C的指针，对于向量<code>x</code>可以通过对第一个元素进行取址来进行转换<code>&amp;x[0]</code>，对于矩阵<code>A</code>则是对其第一行第一列的元素进行取址操作<code>&amp;A[0, 0]</code>。</p>
<p>由于BLAS库中将矩阵数据看成是一个一维数组，所以在调用BLAS函数时需要指定矩阵是Row Major还是Column Major，即参数<code>CBLAS_ORDER Order</code>，这里设定是Row Major，因此函数<code>blas_dgemv</code>中参数<code>A</code>限定是Row Major，即声明为<code>double[:, ::1]</code>。</p>
<p>整个pyx文件的内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cdef extern from &#x27;cblas.h&#x27;:</span><br><span class="line">    enum CBLAS_ORDER:</span><br><span class="line">        CblasRowMajor=101</span><br><span class="line">        CblasColMajor=102</span><br><span class="line">    enum CBLAS_TRANSPOSE:</span><br><span class="line">        CblasNoTrans=111</span><br><span class="line">        CblasTrans=112</span><br><span class="line">        CblasConjTrans=113</span><br><span class="line">        CblasConjNoTrans=114</span><br><span class="line">    void dgemv &quot;cblas_dgemv&quot;(CBLAS_ORDER Order, CBLAS_TRANSPOSE TransA,</span><br><span class="line">                             int M, int N, double alpha, double *A, int lda,</span><br><span class="line">                             double *X, int incX, double beta,</span><br><span class="line">                             double *Y, int incY) nogil</span><br><span class="line"></span><br><span class="line">cpdef blas_dgemv(double[:, ::1] A, double[::1] x, double[::1] y,</span><br><span class="line">                 int M, int N, double alpha, double beta):</span><br><span class="line">    cdef double *A_ptr = &amp;A[0, 0]</span><br><span class="line">    cdef double *x_ptr = &amp;x[0]</span><br><span class="line">    cdef double *y_ptr = &amp;y[0]</span><br><span class="line"></span><br><span class="line">    dgemv(CblasRowMajor, CblasNoTrans, M, N,</span><br><span class="line">          alpha, A_ptr, N, x_ptr, 1, beta, y_ptr, 1)</span><br></pre></td></tr></table></figure>

<p>剩下就是将pyx进行编译，然后就可以在Python中调用<code>blas_dgemv</code>函数了。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://maciejkula.github.io/2015/01/01/calling-blas-from-cython/">Calling BLAS from Cython</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/09/03/Pandas%E5%A4%87%E5%BF%98%E5%BD%952/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/03/Pandas%E5%A4%87%E5%BF%98%E5%BD%952/" class="post-title-link" itemprop="url">Pandas备忘录2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-03 22:30:02" itemprop="dateCreated datePublished" datetime="2018-09-03T22:30:02+08:00">2018-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Pandas备忘录系列文章"><a href="#1-Pandas备忘录系列文章" class="headerlink" title="1. Pandas备忘录系列文章"></a>1. Pandas备忘录系列文章</h2><ol>
<li><a href="/2018/05/06/Pandas%E5%A4%87%E5%BF%98%E5%BD%95/" title="Pandas备忘录">Pandas备忘录</a></li>
</ol>
<h2 id="2-介绍"><a href="#2-介绍" class="headerlink" title="2. 介绍"></a>2. 介绍</h2><p><strong>Note:</strong> 如果没有特别说明，<code>pd</code>指的是<code>pandas</code>，<code>np</code>指的是<code>numpy</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>

<h2 id="3-查找"><a href="#3-查找" class="headerlink" title="3. 查找"></a>3. 查找</h2><h3 id="3-1-contains函数"><a href="#3-1-contains函数" class="headerlink" title="3.1. contains函数"></a>3.1. contains函数</h3><p>主要是用<code>Series.str.contains</code>这个函数，如果参数<code>regex</code>设为True，则查找字符串解析为正则表达式，设为False则用常规查找方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s1 = pd.Series([&#x27;Mouse&#x27;, &#x27;dog&#x27;, &#x27;house and parrot&#x27;, &#x27;23&#x27;, &#x27;frog&#x27;])</span><br><span class="line">&gt;&gt;&gt; s1</span><br><span class="line">0               Mouse</span><br><span class="line">1                 dog</span><br><span class="line">2    house and parrot</span><br><span class="line">3                  23</span><br><span class="line">4                frog</span><br><span class="line">dtype: object</span><br><span class="line">&gt;&gt;&gt; s1.str.contains(&#x27;og&#x27;, regex=False)</span><br><span class="line">0    False</span><br><span class="line">1     True</span><br><span class="line">2    False</span><br><span class="line">3    False</span><br><span class="line">4     True</span><br><span class="line">dtype: bool</span><br><span class="line">&gt;&gt;&gt; s1[s1.str.contains(&#x27;og&#x27;, regex=False)]</span><br><span class="line">1     dog</span><br><span class="line">4    frog</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure>

<h2 id="4-DataFrame增加行"><a href="#4-DataFrame增加行" class="headerlink" title="4. DataFrame增加行"></a>4. DataFrame增加行</h2><h3 id="4-1-append函数"><a href="#4-1-append函数" class="headerlink" title="4.1. append函数"></a>4.1. append函数</h3><p>可以使用<code>append</code>函数给DataFrame增加行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df = pd.DataFrame([[1, 2], [3, 4]], columns=list(&#x27;AB&#x27;))</span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">   A  B</span><br><span class="line">0  1  2</span><br><span class="line">1  3  4</span><br><span class="line">&gt;&gt;&gt; df2 = pd.DataFrame([[5, 6]], columns=list(&#x27;AB&#x27;))</span><br><span class="line">&gt;&gt;&gt; df2</span><br><span class="line">   A  B</span><br><span class="line">0  5  6</span><br><span class="line">&gt;&gt;&gt; df.append(df2, ignore_index=True)</span><br><span class="line">   A  B</span><br><span class="line">0  1  2</span><br><span class="line">1  3  4</span><br><span class="line">2  5  6</span><br></pre></td></tr></table></figure>

<h3 id="4-2-使用特定索引名称增加行"><a href="#4-2-使用特定索引名称增加行" class="headerlink" title="4.2. 使用特定索引名称增加行"></a>4.2. 使用特定索引名称增加行</h3><p>使用DataFrame的<code>loc</code>函数可以指定索引名称增加行，前提是得知道列的排列顺序，因此在创建DataFrame时要用<code>columns</code>参数指定列的排列顺序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; employees = pd.DataFrame(</span><br><span class="line">...     data=&#123;&#x27;Name&#x27;: [&#x27;John Doe&#x27;, &#x27;William Spark&#x27;],</span><br><span class="line">...           &#x27;Age&#x27;: [23, 24]&#125;,</span><br><span class="line">...     index=[&#x27;Emp001&#x27;, &#x27;Emp002&#x27;],</span><br><span class="line">...     columns=[&#x27;Name&#x27;, &#x27;Age&#x27;])</span><br><span class="line">&gt;&gt;&gt; employees</span><br><span class="line">                 Name  Age</span><br><span class="line">Emp001       John Doe   23</span><br><span class="line">Emp002  William Spark   24</span><br><span class="line">&gt;&gt;&gt; employees.loc[&#x27;Emp003&#x27;] = [&#x27;Sunny&#x27;, 45]</span><br><span class="line">&gt;&gt;&gt; employees</span><br><span class="line">                 Name  Age</span><br><span class="line">Emp001       John Doe   23</span><br><span class="line">Emp002  William Spark   24</span><br><span class="line">Emp003          Sunny   45</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/22/Weighted-Random-Sampling-With-Replacement/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/22/Weighted-Random-Sampling-With-Replacement/" class="post-title-link" itemprop="url">Weighted Random Sampling With Replacement</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-22 15:07:18" itemprop="dateCreated datePublished" datetime="2018-07-22T15:07:18+08:00">2018-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Weighted random sampling with replacement，中文翻译为带权重的有放回地采样，简单来说就是每一个样本都有一个权重，然后根据样本权重大小有放回地采样数据，样本的权重越大，样本被选择的概率也就越大。该问题换种方式描述就是，给定一个权重数组 $w$，大小为 $N$，然后根据权重大小，在下标数组 ${0, 1, \ldots, N-1}$ 中进行有放回地采样，下标 $i$ 被选中的概率为 $w[i]&#x2F;\text{sum}(w)$。</p>
<p>这个采样方法一个应用是在Boosting算法中，Boosting算法每次训练完模型时，根据模型分类的情况改变数据样本的权重，然后用带权重的样本训练下一个模型，如果模型的训练不支持带权重的样本，则进行带权重的样本采样。</p>
<blockquote>
<p>本文主要将博文 <a target="_blank" rel="noopener" href="https://www.aarondefazio.com/tangentially/?p=58">WEIGHTED RANDOM SAMPLING WITH REPLACEMENT WITH DYNAMIC WEIGHTS</a> 内容进行解析 (文章拷贝：<a href="/2018/07/22/Weighted-Random-Sampling-With-Replacement/copy.pdf" title="Copy">Copy</a>)。算法实现代码在：<a target="_blank" rel="noopener" href="https://github.com/adefazio/sampler">adefazio&#x2F;sampler</a></p>
</blockquote>
<h2 id="Rejection-Sampling"><a href="#Rejection-Sampling" class="headerlink" title="Rejection Sampling"></a>Rejection Sampling</h2><p>这个思想很简单，给定一个权重数组 $w \in R^N$，权重最大值为 $w_\max$，然后在下标数组 ${ 0, 1, \ldots, N-1 }$ 中随机采样得到下标 $i$，接下来就是判断该下标是否被accept，首先根据分布 $X \sim U(0, 1)$ 获得一个随机数 $x$，然后判断 $w_\max * x \le w[i]$，如果符合该条件，则accept该下标 $i$，否则就reject该下标。</p>
<p>算法实现的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">w = [1,4,2,5] # Some data</span><br><span class="line">w_max = max(w)</span><br><span class="line">n = len(w)</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">	idx = random.randrange(n)</span><br><span class="line">	u = w_max*random.random()</span><br><span class="line">	if u &lt;= w[idx]:</span><br><span class="line">		break</span><br><span class="line">print idx</span><br></pre></td></tr></table></figure>

<p>算法思想可以用下面图表示：</p>
<img src="/2018/07/22/Weighted-Random-Sampling-With-Replacement/rejection.png" class="">

<p>橘色区域代表accept区域，灰色区域代表reject区域。这个算法有个缺点就是当数据不平衡时，性能会很低，因为如果小部分数据权重很大时，$w_\max$ 会变的很大，数据权重小的下标很难被accept，而且权重小的占大部分，这导致算法会经过很多次循环。</p>
<h2 id="Level-Rejection-Sampling"><a href="#Level-Rejection-Sampling" class="headerlink" title="Level Rejection Sampling"></a>Level Rejection Sampling</h2><p>这个是在Rejection Sampling之前对下标进行分层 (level)，根据权重 $w[i]$ 的大小将下标 $i$ 分到不同层中，第 $k$ 层权重的范围为 $[2^k, 2^{k+1}]$，由于每一层内的权重的差距不会偏大，对该层进行Rejection Sampling效率会较高。</p>
<p>该方法的思想如下图所示：</p>
<img src="/2018/07/22/Weighted-Random-Sampling-With-Replacement/sampling-visual.png" class="">

<p>如图所示，总共分了5层，每一层存储的是数组下标。下标分层后，在进行采样时，首先随机选择某一层，然后进行Rejection Sampling获得最终想要的下标。</p>
<h3 id="模拟实验"><a href="#模拟实验" class="headerlink" title="模拟实验"></a>模拟实验</h3><p>贴出一段实验代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sampler <span class="keyword">import</span> Sampler</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    weights = np.array([<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>], dtype=<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">    num_entries = <span class="built_in">len</span>(weights)</span><br><span class="line">    normalized_weights = weights / np.<span class="built_in">sum</span>(weights)</span><br><span class="line"></span><br><span class="line">    weight_sampler = Sampler(num_entries, max_value=<span class="number">100</span>, min_value=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_entries):</span><br><span class="line">        weight_sampler.add(i, weights[i])</span><br><span class="line"></span><br><span class="line">    num_samples = <span class="number">10000</span></span><br><span class="line">    distro = np.zeros(num_entries)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_samples):</span><br><span class="line">        idx = weight_sampler.sample()</span><br><span class="line">        distro[idx] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    normalized_distro = distro / np.<span class="built_in">sum</span>(distro)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Sample distribution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(distro))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Weights distribution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(weights))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Normalized sample distribution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(normalized_distro))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Normalized weights distribution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(normalized_weights))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># plot frequency</span></span><br><span class="line">    plt.bar(np.arange(num_entries),</span><br><span class="line">            normalized_weights, width=<span class="number">0.35</span>,</span><br><span class="line">            label=<span class="string">&#x27;Normalized Weights Distribution&#x27;</span>)</span><br><span class="line">    plt.bar(np.arange(num_entries)+<span class="number">0.35</span>,</span><br><span class="line">            normalized_distro, width=<span class="number">0.35</span>,</span><br><span class="line">            label=<span class="string">&#x27;Normalized Sample Distribution&#x27;</span>)</span><br><span class="line">    plt.legend()</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sample distribution: [ 843.  824. 2513. 4182. 1638.]</span><br><span class="line">Weights distribution: [1. 1. 3. 5. 2.]</span><br><span class="line">Normalized sample distribution: [0.0843 0.0824 0.2513 0.4182 0.1638]</span><br><span class="line">Normalized weights distribution: [0.08333333 0.08333333 0.25 0.41666667 0.16666667]</span><br></pre></td></tr></table></figure>

<p>得到的结果如下图所示：</p>
<img src="/2018/07/22/Weighted-Random-Sampling-With-Replacement/test.png" class="">

<p>图中横坐标代表数组下标，蓝色柱代表各个下标的权重大小 (归一化)，橘色柱代表经过大量采样时，各个下标被采中的比例。从图中可以看出，采样结果基本符合权重分布规律，权重越大，被采中的概率也就越大。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/18/%E4%BB%A5Column-major-Order%E8%AF%BB%E5%8F%96HDF5%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/18/%E4%BB%A5Column-major-Order%E8%AF%BB%E5%8F%96HDF5%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">以Column-major Order读取HDF5数据</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-18 09:39:07" itemprop="dateCreated datePublished" datetime="2018-07-18T09:39:07+08:00">2018-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在使用h5py这类库读取HDF5里面的数据时，数据的存储方式为row-major order，而一些机器学习算法的实现在使用数据时需要的存储方式为column-major order，此时需要对数据进行转换。如果数据量很小，转换是没有问题的，如果数据量巨大，进行转换时，由于需要多一倍内存来存放转换的数据，因此可能导致内存溢出。本篇博文主要是重新实现h5py库中的 <code>read_direct</code> 函数，使得该函数在读取HDF5文件时，可以使得读取到内存的数据是以column-major order方式存储。</p>
<p>相关实现代码在: <a target="_blank" rel="noopener" href="https://gist.github.com/luowanqian/b924987be33d51f50a30e741fe249526">HDF5 gist</a></p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>基本思路就是一行行地读取HDF5文件里面的数据，然后存储到内存的数组中，内存的数组是以column-major order方式存储数据。这里假设HDF5文件里面的数据存储是连续的，没有进行分块，复杂的情况等以后再实现，这里只是应对最简单的情况。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>实现主要是 Python + C 形式，Python部分主要提供一个函数接口用于调用，C部分主要是使用HDF5 C API对HDF5数据进行读取，两者之间的相互调用使用的是Cython。</p>
<h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><p>这部分需要使用HDF5库提供的C API对HDF5文件数据进行读取。主要使用的API是 <code>H5Sselect_hyperslab</code>，这个函数可以设定读取存储空间的哪一部分数据或者将数据存在存储空间的哪一部分，这里的存储空间是一个抽象概念，既可以表示HDF5文件里面内容，也可以表示内存申请的存储空间，这里我们分别对HDF5文件内容和内存申请的空间分别进行设定。实现代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * 从H5文件中读取矩阵数据，以column order存储数据</span><br><span class="line"> *</span><br><span class="line"> * filename: H5文件名</span><br><span class="line"> * dataset_name: 数据集名</span><br><span class="line"> * buffer: 数据内存存储处，大小为 num_rows * num_cols</span><br><span class="line"> * num_rows: 待读取的矩阵的行数</span><br><span class="line"> * num_cols: 待读取的矩阵的列数</span><br><span class="line"> * offset_x: 读取的数据在H5文件中的矩阵的x方向上的偏移 (第几行)</span><br><span class="line"> * offset_y: 读取的数据在H5文件中的矩阵的y方向上的偏移 (第几列)</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">int read_direct_f(char *file_name, char *dataset_name, double *buffer,</span><br><span class="line">                  int num_rows, int num_cols, int offset_x, int offset_y)</span><br><span class="line">&#123;</span><br><span class="line">    int i;</span><br><span class="line"></span><br><span class="line">    hid_t file_id, dataset_id;</span><br><span class="line">    hid_t dataspace_id, memspace_id;</span><br><span class="line">    herr_t status;</span><br><span class="line"></span><br><span class="line">    hsize_t dims_mem[1];</span><br><span class="line"></span><br><span class="line">    hsize_t offset[2];</span><br><span class="line">    hsize_t count[2];</span><br><span class="line">    hsize_t stride[2];</span><br><span class="line">    hsize_t block[2];</span><br><span class="line">    hsize_t offset_mem[1];</span><br><span class="line">    hsize_t count_mem[1];</span><br><span class="line">    hsize_t stride_mem[1];</span><br><span class="line">    hsize_t block_mem[1];</span><br><span class="line"></span><br><span class="line">    // open the hdf5 file and the dataset</span><br><span class="line">    file_id = H5Fopen(file_name, H5F_ACC_RDONLY, H5P_DEFAULT);</span><br><span class="line">    dataset_id = H5Dopen2(file_id, dataset_name, H5P_DEFAULT);</span><br><span class="line"></span><br><span class="line">    // get file dataspace</span><br><span class="line">    dataspace_id = H5Dget_space(dataset_id);</span><br><span class="line"></span><br><span class="line">    // create memory space</span><br><span class="line">    dims_mem[0] = num_rows;         // avoid numeric overflow</span><br><span class="line">    dims_mem[0] = dims_mem[0] * num_cols;</span><br><span class="line">    memspace_id = H5Screate_simple(1, dims_mem, NULL);</span><br><span class="line"></span><br><span class="line">    // specify size and shape of subset to read</span><br><span class="line">    offset[0] = offset_x;</span><br><span class="line">    offset[1] = offset_y;</span><br><span class="line">    count[0] = 1;</span><br><span class="line">    count[1] = num_cols;</span><br><span class="line">    stride[0] = 1;</span><br><span class="line">    stride[1] = 1;</span><br><span class="line">    block[0] = 1;</span><br><span class="line">    block[1] = 1;</span><br><span class="line">    offset_mem[0] = 0;</span><br><span class="line">    count_mem[0] = num_cols;</span><br><span class="line">    stride_mem[0] = num_rows;</span><br><span class="line">    block_mem[0] = 1;</span><br><span class="line"></span><br><span class="line">    for (i=0; i&lt;num_rows; i++) &#123;</span><br><span class="line">        offset[0] = offset_x + i;</span><br><span class="line">        offset_mem[0] = i;</span><br><span class="line"></span><br><span class="line">        // select subset from dataspace</span><br><span class="line">        status = H5Sselect_hyperslab(dataspace_id, H5S_SELECT_SET,</span><br><span class="line">                                     offset, stride, count, block);</span><br><span class="line">        if (status &lt; 0) &#123;</span><br><span class="line">            H5Eprint2(H5E_DEFAULT, NULL);</span><br><span class="line">            return -1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        status = H5Sselect_hyperslab(memspace_id, H5S_SELECT_SET,</span><br><span class="line">                                     offset_mem, stride_mem,</span><br><span class="line">                                     count_mem, block_mem);</span><br><span class="line">        if (status &lt; 0) &#123;</span><br><span class="line">            H5Eprint2(H5E_DEFAULT, NULL);</span><br><span class="line">            return -1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // read data</span><br><span class="line">        status = H5Dread(dataset_id, H5T_NATIVE_DOUBLE,</span><br><span class="line">                         memspace_id, dataspace_id,</span><br><span class="line">                         H5P_DEFAULT, buffer);</span><br><span class="line">        if (status &lt; 0) &#123;</span><br><span class="line">            H5Eprint2(H5E_DEFAULT, NULL);</span><br><span class="line">            return -1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // close the resources</span><br><span class="line">    H5Sclose(memspace_id);</span><br><span class="line">    H5Sclose(dataspace_id);</span><br><span class="line">    H5Dclose(dataset_id);</span><br><span class="line">    H5Fclose(file_id);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基本实现思路就是每次就只读取HDF5文件中矩阵的一行，然后写入到内存空间中，每次读取都要用函数 <code>H5Sselect_hyperslab</code> 函数设定读取区域，同样，每次写入都要使用函数 <code>H5Sselect_hyperslab</code> 设定写入区域。这个实现思想参考了HDF5官方教程 <a target="_blank" rel="noopener" href="https://portal.hdfgroup.org/display/HDF5/Reading+From+or+Writing+To+a+Subset+of+a+Dataset">Reading From or Writing To a Subset of a Dataset</a>，教程中仅仅设定了文件的读取区域，没有设定写入区域。</p>
<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>这部分使用Cython来实现Python中调用前面所写的C语言代码，这部分代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def read_direct_fortran(str file_name, str dataset_name,</span><br><span class="line">                        double[::1, :] data, int offset_x, int offset_y):</span><br><span class="line">    cdef int num_rows</span><br><span class="line">    cdef int num_cols</span><br><span class="line">    cdef bytes file_name_bytes = bytes(file_name, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">    cdef bytes dataset_name_bytes = bytes(dataset_name, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">    cdef int ret;</span><br><span class="line"></span><br><span class="line">    num_rows = data.shape[0]</span><br><span class="line">    num_cols = data.shape[1]</span><br><span class="line"></span><br><span class="line">    ret = read_direct_f(file_name_bytes, dataset_name_bytes, &amp;data[0, 0],</span><br><span class="line">                        num_rows, num_cols, offset_x, offset_y)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/15/LeetCode-7-Reverse-Integer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/15/LeetCode-7-Reverse-Integer/" class="post-title-link" itemprop="url">LeetCode 7 - Reverse Integer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-15 23:07:07" itemprop="dateCreated datePublished" datetime="2018-07-15T23:07:07+08:00">2018-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>Given a 32-bit signed integer, reverse digits of an integer.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 123</span><br><span class="line">Output: 321</span><br></pre></td></tr></table></figure>

<p><strong>Example 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: -123</span><br><span class="line">Output: -321</span><br></pre></td></tr></table></figure>

<p><strong>Example 3:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 120</span><br><span class="line">Output: 21</span><br></pre></td></tr></table></figure>

<p><strong>Note:</strong></p>
<p>Assume we are dealing with an environment which could only store integers within the 32-bit signed integer range: $[−2^{31},  2^{31} − 1]$. For the purpose of this problem, assume that your function returns 0 when the reversed integer overflows.</p>
<p><strong>Related Topics:</strong> Math</p>
<p>原问题: <a target="_blank" rel="noopener" href="https://leetcode.com/problems/reverse-integer/description/">7. Reverse Integer</a></p>
<p>中文翻译版: <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reverse-integer/description/">7. 反转整数</a></p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>解决思路就是：利用求模得到数字的每一位，求位的顺序要从低位到高位，然后根据获得的数位构造出逆数。这里有个困难就在求解过程中会发生数字溢出，一个解决方案就是用更多字节的整数类型来表示逆数，题目中使用的整数int是四个字节，此时可以用八字节的long long代替，然后判断数是否在32位整数表示的范围即可。代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    int reverse(int x) &#123;</span><br><span class="line">        int mod;</span><br><span class="line">        long long num;</span><br><span class="line">        bool postive;</span><br><span class="line"></span><br><span class="line">        num = 0;</span><br><span class="line">        postive = x &gt;=0 ? true : false;</span><br><span class="line">        while (x) &#123;</span><br><span class="line">            mod = x % 10;</span><br><span class="line">            x = x / 10;</span><br><span class="line">            num = num * 10 + mod;</span><br><span class="line">            if ((postive &amp;&amp; num &gt; 0x7FFFFFFF)</span><br><span class="line">                || (!postive &amp;&amp; num &lt; (signed int)0x80000000))</span><br><span class="line">                return 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x = 120;</span><br><span class="line"></span><br><span class="line">    Solution solu;</span><br><span class="line">    cout &lt;&lt; &quot;Revert: &quot; &lt;&lt; solu.reverse(x) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/14/Stirling-s-approximation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luo Wanqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="袋熊的树洞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/14/Stirling-s-approximation/" class="post-title-link" itemprop="url">Stirling's approximation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-14 21:36:10" itemprop="dateCreated datePublished" datetime="2018-07-14T21:36:10+08:00">2018-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-02 21:44:33" itemprop="dateModified" datetime="2025-03-02T21:44:33+08:00">2025-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>斯特林公式 (Stirling’s approximation) 是一条用来取n的阶乘的近似值的数学公式。常见的形式为</p>
<p>$$<br>n! \approx \sqrt{2 \pi n} (\frac{n}{e})^n<br>$$</p>
<p>对n的阶乘取自然对数，可以得到</p>
<p>$$<br>\ln{(n!)} \approx \frac{1}{2} \ln{(2 \pi)} + (n + \frac{1}{2}) \ln{(n)} - n<br>$$</p>
<p>一个会经常遇到的问题，那就是计算 $n! &#x2F; a_n$，单独计算 $n!$ 需要很大的计算量，如果将问题转换为</p>
<p>$$<br>\frac{n!}{a_n} &#x3D; e^{\ln{(n!)} - \ln{(a_n)}}<br>$$</p>
<p>$\ln{(n!)}$ 可以用前面介绍的近似公式进行求解，此时计算量就会小很多。</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>这里举一个例子来感受下这个近似公式是如何缩减大量计算量。一个经典的概率问题－Birthday Problem</p>
<blockquote>
<p><strong>Birthday Prolem</strong></p>
<p>Calculate the probability p that at least two people in a group of k people will have the same birthday, that is, will have been born on the same day of the same month but not necessarily in the same year.</p>
</blockquote>
<p>可以很快地想到</p>
<blockquote>
<p>至少两个人的生日相同的概率 &#x3D; 1 - 所有人的生日不相同的概率</p>
</blockquote>
<p>则计算公式为</p>
<p>$$<br>p &#x3D; 1 - \frac{P_{365, k}}{365^k}<br>$$</p>
<p>其中 $P_{365, k}$ 为排列公式，等于 $365! &#x2F; (365 - k)!$，则概率 $p$ 为</p>
<p>$$<br>p &#x3D; 1 - \frac{365!}{(365 - k)!365^k}<br>$$</p>
<p>如果按照这个式子一个个计算里面的每一项时，需要很大的计算量，尤其是 $365!$，一般计算器估计算不出来。此时，我们将式子用指数，对数进行改写，可写为</p>
<p>$$<br>p &#x3D; 1 - e^{\ln{(365)!} - \ln{(365-k)!} - k\ln{(365)}}<br>$$</p>
<p>其中 $\ln{(365)!}$ 和 $\ln{(365-k)!}$ 可以用Stirling公式进行近似计算，可以得到</p>
<p>$$<br>\begin{align}<br>&amp; \ln{(365)!} - \ln{(365-k)!} - k \ln{(365)}  \<br>\approx ; &amp; \left[\frac{1}{2} \ln{(2 \pi)} + (365 + \frac{1}{2}) \ln{(365)} - 365 \right] \<br>&amp; - \left[ \frac{1}{2} \ln{(2 \pi)} + (365 - k + \frac{1}{2}) \ln{(365-k)} - 365 + k \right] \<br>&amp; - k \ln{(365)} \<br>\approx ; &amp; (365 + \frac{1}{2}) \ln{(365)} - (365 - k + \frac{1}{2}) \ln{(365-k)} - k - k \ln {(365)}<br>\end{align}<br>$$</p>
<p>可见，阶乘和指数部分变成一堆对数的乘积以及求和，这样计算量就小了很多。这里贴一下用Python实现的概率计算程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import math</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    k = int(sys.argv[1])</span><br><span class="line">    sum = ((365 + 0.5) * math.log(365) -</span><br><span class="line">           (365 - k + 0.5) * math.log(365 - k) -</span><br><span class="line">           k - k * math.log(365))</span><br><span class="line">    prob = 1.0 - math.exp(sum)</span><br><span class="line">    print(&#x27;Probability (k = &#123;&#125;) is &#123;&#125;&#x27;.format(k, prob))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用程序计算了一些值，得到下面列表</p>
<table>
<thead>
<tr>
<th>k</th>
<th>prob</th>
<th></th>
<th>k</th>
<th>prob</th>
</tr>
</thead>
<tbody><tr>
<td>5</td>
<td>0.027</td>
<td></td>
<td>30</td>
<td>0.706</td>
</tr>
<tr>
<td>10</td>
<td>0.117</td>
<td></td>
<td>40</td>
<td>0.891</td>
</tr>
<tr>
<td>15</td>
<td>0.253</td>
<td></td>
<td>50</td>
<td>0.970</td>
</tr>
<tr>
<td>20</td>
<td>0.411</td>
<td></td>
<td>60</td>
<td>0.994</td>
</tr>
<tr>
<td>25</td>
<td>0.569</td>
<td></td>
<td>70</td>
<td>0.999</td>
</tr>
</tbody></table>
<p>从表格中可以看到，$k &#x3D; 70$ 时，概率很接近 $1$ 了，原以为至少需要100多人才可能达到0.999这个概率值，可是现在看来是不需要达到100人就可以了。这让我想起了在班里，有人的生日和我是同一天，整个班的人数大概是50人，根据表格，可以得到概率为0.970，由此可见班里同学生日和我同一天的概率还是挺高的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Luo Wanqian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">80</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Luo Wanqian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
